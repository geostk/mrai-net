<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: volfft.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>volfft.c</h1><a href="volfft_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: volfft.c,v 1.1 2005/09/09 08:22:56 bellet Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 1.0  05/09/2005</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="comment">/*</span>
00037 <span class="comment"> * FFT Tridimensionnelle d'un volume USHORT -&gt; VolFFT</span>
00038 <span class="comment"> * IFFT Tridimensionnelle d'un volume COMPLEX double precision -&gt; VolIFFT</span>
00039 <span class="comment"> */</span>
00040 
00041 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00042 <span class="preprocessor">#include &lt;math.h&gt;</span>
00043 <span class="preprocessor">#include "<a class="code" href="idsig_8h.html">idsig.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="idima_8h.html">idima.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="idvol_8h.html">idvol.h</a>"</span>
00046 <span class="preprocessor">#include "<a class="code" href="iderr_8h.html">iderr.h</a>"</span>
00047 <span class="preprocessor">#include "<a class="code" href="idprint_8h.html">idprint.h</a>"</span>
00048 
00049 <span class="keyword">static</span> <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> 
00050 recon_3d(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volr)
00051 {
00052    <span class="keywordtype">int</span> i, j, k, dimx, dimy, dimz;
00053    <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volx;
00054 
00055    dimx = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volr) / 2;
00056    dimy = <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volr) / 2;
00057    dimz = <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volr) / 2;
00058 
00059    volx =
00060        (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volr),
00061                   <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volr),
00062                   <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volr), VOL_COMPLEX);
00063    <span class="keywordflow">if</span> (volx == NULL)
00064       <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a>(<span class="stringliteral">"\n PROBLEME D'ALLOCATION "</span>);
00065 
00066    <span class="keywordflow">for</span> (i = 0; i &lt; dimz; i++)
00067       <span class="keywordflow">for</span> (j = 0; j &lt; dimy; j++)
00068          <span class="keywordflow">for</span> (k = 0; k &lt; dimx; k++)
00069 
00070           {
00071             volx[i][j][k] =
00072                 volr[i + dimz][j + dimy][k + dimx];
00073             volx[i][j + dimy][k] =
00074                 volr[i + dimz][j][k + dimx];
00075             volx[i + dimz][j + dimy][k] =
00076                 volr[i][j][k + dimx];
00077             volx[i + dimz][j][k] =
00078                 volr[i][j + dimy][k + dimx];
00079 
00080             volx[i][j][k + dimx] =
00081                 volr[i + dimz][j + dimy][k];
00082             volx[i][j + dimy][k + dimx] =
00083                 volr[i + dimz][j][k];
00084             volx[i + dimz][j + dimy][k + dimx] =
00085                 volr[i][j][k];
00086             volx[i + dimz][j][k + dimx] =
00087                 volr[i][j + dimy][k];
00088          }
00089    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volr);
00090    <span class="keywordflow">return</span> (volx);
00091 }
00092 
00093 <span class="keyword">static</span> <span class="keywordtype">void</span> 
00094 FFT1Dbis(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volc)
00095 {
00096    <span class="keywordtype">int</span> i, j, k, Tx;
00097    <a class="code" href="structCOMPLEX.html">PSIGNAL_COMPLEX</a> lign;
00098    <span class="keywordtype">double</span> sqtx;
00099 
00100    Tx = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volc);
00101    sqtx = sqrt((<span class="keywordtype">double</span>) (Tx));
00102    lign = (<a class="code" href="structCOMPLEX.html">PSIGNAL_COMPLEX</a>) <a class="code" href="sigallo_8c.html#a1">IdSigAlloc</a>(Tx, SIG_COMPLEX);
00103 
00104    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volc); i++)
00105       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volc); j++) {
00106          <span class="comment">/*</span>
00107 <span class="comment">          * remplissage de la ligne </span>
00108 <span class="comment">          */</span>
00109          <span class="keywordflow">for</span> (k = 0; k &lt; Tx; k++) {
00110             lign[k] = volc[i][j][k];
00111          }
00112          <span class="comment">/*</span>
00113 <span class="comment">          * calcul de la FFT de la ligne </span>
00114 <span class="comment">          */</span>
00115          <a class="code" href="sigfft_8c.html#a2">IdSigFFT</a>(lign, 1);
00116          <span class="comment">/*</span>
00117 <span class="comment">          * copie dans la ligne correspondante de volc </span>
00118 <span class="comment">          */</span>
00119          <span class="keywordflow">for</span> (k = 0; k &lt; Tx; k++) {
00120             volc[i][j][k].<a class="code" href="structCOMPLEX.html#o0">re</a> = lign[k].<a class="code" href="structCOMPLEX.html#o0">re</a> / (sqtx);
00121             volc[i][j][k].<a class="code" href="structCOMPLEX.html#o1">im</a> = lign[k].<a class="code" href="structCOMPLEX.html#o1">im</a> / (sqtx);
00122          }
00123       }
00124    <a class="code" href="idsig-base_8h.html#a0">IdSigFree</a>(lign);
00125 }
00126 
00127 
00128 <span class="keyword">static</span> <span class="keywordtype">void</span> 
00129 IFFT1Dbis(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volc)
00130 {
00131    <span class="keywordtype">int</span> i, j, k, Tx;
00132    <a class="code" href="structCOMPLEX.html">PSIGNAL_COMPLEX</a> lign;
00133    <span class="keywordtype">double</span> sqtx;
00134 
00135    Tx = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volc);
00136    sqtx = sqrt((<span class="keywordtype">double</span>) (Tx));
00137    lign = (<a class="code" href="structCOMPLEX.html">PSIGNAL_COMPLEX</a>) <a class="code" href="sigallo_8c.html#a1">IdSigAlloc</a>(Tx, SIG_COMPLEX);
00138 
00139    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volc); i++)
00140       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volc); j++) {
00141          <span class="comment">/*</span>
00142 <span class="comment">          * remplissage de la ligne </span>
00143 <span class="comment">          */</span>
00144          <span class="keywordflow">for</span> (k = 0; k &lt; Tx; k++) {
00145             lign[k] = volc[i][j][k];
00146          }
00147          <span class="comment">/*</span>
00148 <span class="comment">          * calcul de la IFFT de la ligne </span>
00149 <span class="comment">          */</span>
00150          <a class="code" href="sigfft_8c.html#a2">IdSigFFT</a>(lign, -1);
00151          <span class="comment">/*</span>
00152 <span class="comment">          * copie dans la ligne correspondante de volc </span>
00153 <span class="comment">          */</span>
00154          <span class="keywordflow">for</span> (k = 0; k &lt; Tx; k++) {
00155             volc[i][j][k].<a class="code" href="structCOMPLEX.html#o0">re</a> = lign[k].<a class="code" href="structCOMPLEX.html#o0">re</a> * (sqtx);
00156             volc[i][j][k].<a class="code" href="structCOMPLEX.html#o1">im</a> = lign[k].<a class="code" href="structCOMPLEX.html#o1">im</a> * (sqtx);
00157          }
00158       }
00159    <a class="code" href="idsig-base_8h.html#a0">IdSigFree</a>(lign);
00160 }
00161 
00162 
00163 <span class="keyword">static</span> <span class="keywordtype">void</span> 
00164 transposition_3d(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volc, <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> voli)
00165 {
00166    <span class="keywordtype">int</span> i, j, k;
00167    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volc); i++)
00168       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volc); j++)
00169          <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volc); k++)
00170 
00171             voli[i][j][k] = volc[k][i][j];
00172    <span class="keywordflow">return</span>;
00173 }
00174 
<a name="l00187"></a><a class="code" href="volfft_8c.html#a0">00187</a> <span class="preprocessor">#define FF3(typevol) \</span>
00188 <span class="preprocessor">      for(k=0;k&lt;Tz;k++) \</span>
00189 <span class="preprocessor">      for(i=0;i&lt;Ty;i++) \</span>
00190 <span class="preprocessor">         for(j=0;j&lt;Tx;j++) \</span>
00191 <span class="preprocessor">      {  volr[k][i][j].re=((typevol)vols)[k][i][j]; \</span>
00192 <span class="preprocessor">         volr[k][i][j].im=0; \</span>
00193 <span class="preprocessor">      }</span>
00194 <span class="preprocessor"></span>
00195 
00196 <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> 
<a name="l00197"></a><a class="code" href="volfft_8c.html#a5">00197</a> <a class="code" href="volfft_8c.html#a5">IdVolFFT</a>(PPPVOLUME vols)
00198 {
00199    <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> voli;
00200    <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volr;
00201    <span class="keywordtype">int</span> i, j, k, Tx, Ty, Tz;
00202 
00203    Tx = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(vols);
00204    Ty = <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(vols);
00205    Tz = <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(vols);
00206 
00207    volr = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Tx, Ty, Tz, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00208 
00209    <span class="keywordflow">switch</span> (<a class="code" href="idvol-ido_8h.html#a33">IdVolType</a>(vols)) {
00210    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a0">VOL_CHAR</a>:
00211       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a35">PPPVOLUME_CHAR</a>);
00212       <span class="keywordflow">break</span>;
00213    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a1">VOL_UCHAR</a>:
00214       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a36">PPPVOLUME_UCHAR</a>);
00215       <span class="keywordflow">break</span>;
00216    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a2">VOL_SHORT</a>:
00217       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a41">PPPVOLUME_SHORT</a>);
00218       <span class="keywordflow">break</span>;
00219    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a3">VOL_USHORT</a>:
00220       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a42">PPPVOLUME_USHORT</a>);
00221       <span class="keywordflow">break</span>;
00222    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a4">VOL_LONG</a>:
00223       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a43">PPPVOLUME_LONG</a>);
00224       <span class="keywordflow">break</span>;
00225    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a5">VOL_ULONG</a>:
00226       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a44">PPPVOLUME_ULONG</a>);
00227       <span class="keywordflow">break</span>;
00228    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a6">VOL_FLOAT</a>:
00229       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>);
00230       <span class="keywordflow">break</span>;
00231    <span class="keywordflow">case</span> <a class="code" href="idvol-ido_8h.html#a7">VOL_DOUBLE</a>:
00232       <a class="code" href="imagette_8c.html#a2">FF3</a>(<a class="code" href="idvol-ido_8h.html#a38">PPPVOLUME_DOUBLE</a>);
00233       <span class="keywordflow">break</span>;
00234 
00235    <span class="keywordflow">default</span>:
00236       <a class="code" href="idprint_8h.html#a1">IdErrPrintf</a>
00237           (<span class="stringliteral">"Type %d non traitable par la fonction IdVolFFT !\n"</span>,
00238            <a class="code" href="idvol-ido_8h.html#a33">IdVolType</a>(vols));
00239       <a class="code" href="iderr_8h.html#a65">IdErrno</a> = <a class="code" href="iderr_8h.html#a15">IDERR_WRONG_LIBTYPE</a>;
00240       <span class="keywordflow">return</span> (0);
00241    }
00242 
00243    FFT1Dbis(volr);
00244    voli = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Tz, Tx, Ty, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00245    transposition_3d(volr, voli);
00246    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volr);
00247 
00248    FFT1Dbis(voli);
00249    volr = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Ty, Tz, Tx, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00250    transposition_3d(voli, volr);
00251    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voli);
00252 
00253    FFT1Dbis(volr);
00254    voli = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Tx, Ty, Tz, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00255    transposition_3d(volr, voli);
00256 
00257    voli = recon_3d(voli);
00258 
00259    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volr);
00260    <span class="keywordflow">return</span> (voli);
00261 }
00262 
00275 <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> 
<a name="l00276"></a><a class="code" href="volfft_8c.html#a6">00276</a> <a class="code" href="volfft_8c.html#a6">IdVolIFFT</a>(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> volsource)
00277 {
00278    <a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a> voli;
00279    <span class="keywordtype">int</span> Tx, Ty, Tz;
00280 
00281 
00282    Tx = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volsource);
00283    Ty = <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volsource);
00284    Tz = <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volsource);
00285 
00286    <span class="comment">/*</span>
00287 <span class="comment">    * transformee de Fourier premiere passe </span>
00288 <span class="comment">    */</span>
00289    IFFT1Dbis(volsource);
00290    voli = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Tz, Tx, Ty, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00291    transposition_3d(volsource, voli);
00292    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volsource);
00293 
00294    <span class="comment">/*</span>
00295 <span class="comment">    * transformee de Fourier deuxieme passe </span>
00296 <span class="comment">    */</span>
00297 
00298    IFFT1Dbis(voli);
00299    volsource =
00300        (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Ty, Tz, Tx, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00301    transposition_3d(voli, volsource);
00302    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voli);
00303 
00304    <span class="comment">/*</span>
00305 <span class="comment">    * transformee de Fourier troisieme passe </span>
00306 <span class="comment">    */</span>
00307 
00308    IFFT1Dbis(volsource);
00309    voli = (<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(Tx, Ty, Tz, <a class="code" href="idvol-ido_8h.html#a8">VOL_COMPLEX</a>);
00310    transposition_3d(volsource, voli);
00311    <span class="comment">/*</span>
00312 <span class="comment">    * voli=recon_3d(voli); </span>
00313 <span class="comment">    */</span>
00314    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volsource);
00315 
00316    <span class="keywordflow">return</span> (voli);
00317 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:15 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
