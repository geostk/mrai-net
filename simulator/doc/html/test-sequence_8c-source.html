<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: test-sequence.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>test-sequence.c</h1><a href="test-sequence_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: test-sequence.c,v 1.32 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment">* TestSequence function is an excellent example of how to run a simulation</span>
00005 <span class="comment">* with the object definition, the experience definition, the sequence call</span>
00006 <span class="comment">* and the reconstruction step. It gives also variation about adding noise</span>
00007 <span class="comment">* and filtering at several step</span>
00008 <span class="comment">* One should copy such function to make similar tests in 3D</span>
00009 <span class="comment">**************************************************************************</span>
00010 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00011 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00012 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00013 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00014 <span class="comment">  "http://www.cecill.info". </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00017 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00018 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00019 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00020 <span class="comment">  liability. </span>
00021 <span class="comment">  </span>
00022 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00023 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00024 <span class="comment">  software by the user in light of its specific status of free software,</span>
00025 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00026 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00027 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00028 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00029 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00030 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00031 <span class="comment">  same conditions as regards security. </span>
00032 <span class="comment">  </span>
00033 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00034 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00035 <span class="comment">  </span>
00036 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00037 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00038 <span class="comment">  </span>
00039 <span class="comment">  Version 2.0  20/12/2006</span>
00040 <span class="comment">*************************************************************************/</span>
00041 <span class="preprocessor">#include "<a class="code" href="test-sequence_8h.html">test-sequence.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="idvol_8h.html">idvol.h</a>"</span>
00043 <span class="preprocessor">#include "<a class="code" href="idacr_8h.html">idacr.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="simri3d_8h.html">simri3d.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="experience_8h.html">experience.h</a>"</span>
00046 <span class="preprocessor">#include "<a class="code" href="object_8h.html">object.h</a>"</span>
00047 <span class="preprocessor">#include "<a class="code" href="object-simple_8h.html">object-simple.h</a>"</span>
00048 <span class="preprocessor">#include "<a class="code" href="object-compound_8h.html">object-compound.h</a>"</span>
00049 <span class="preprocessor">#include "<a class="code" href="object-brain_8h.html">object-brain.h</a>"</span>
00050 <span class="preprocessor">#include "<a class="code" href="object-ki_8h.html">object-ki.h</a>"</span>
00051 <span class="preprocessor">#include "<a class="code" href="output_8h.html">output.h</a>"</span>
00052 <span class="preprocessor">#include "<a class="code" href="display_8h.html">display.h</a>"</span>
00053 <span class="preprocessor">#include "<a class="code" href="seq-se_8h.html">seq-se.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="sequence_8h.html">sequence.h</a>"</span>
00055 
00056 <span class="preprocessor">#ifdef HAVE_MPI</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mpi.h&gt;</span>
00058 <span class="preprocessor">#endif</span>
00059 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="group__Test.html#ga0">00082</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga0">TestSequence2D</a>(<span class="keywordtype">int</span> obj,<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> imasize,
00083                <span class="keywordtype">double</span> tacq,<span class="keywordtype">double</span> TE,<span class="keywordtype">double</span> TR,<span class="keywordtype">double</span> teta,
00084                <span class="keywordtype">double</span> b0, <span class="keywordtype">double</span> db0,<span class="keywordtype">double</span> b0def,<span class="keywordtype">int</span> flagres,<span class="keywordtype">int</span> flagdech,<span class="keywordtype">int</span> filter,
00085                <span class="keywordtype">char</span> * fileout,<span class="keywordtype">char</span> * seqname,<span class="keywordtype">int</span> display, <span class="keywordtype">int</span> inhomogeneousB1)
00086   {
00087     <span class="keywordtype">char</span> fic[80];
00088     <span class="keywordtype">int</span> i, j, k;
00089     <span class="keywordtype">int</span> ntx, nty, ntz;     <span class="comment">/* K space size */</span>
00090     <span class="keywordtype">double</span> fovx,fovy,fovz; <span class="comment">/* Fov size in meter */</span>
00091     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00092    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> *expr;
00093    <a class="code" href="sequence_8h.html#a0">SEQPARAM</a> seqparam;
00094     <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>  volrf;
00095     <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> volrecmod; 
00096 <span class="preprocessor">#ifdef HAVE_MPI</span>
00097 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00098 <span class="preprocessor">#endif</span>
00099 <span class="preprocessor"></span>    fic[0]=<span class="charliteral">'\0'</span>;
00100 
00101    printf(<span class="stringliteral">"TestSequence2D start\n"</span>);   
00102     
00103    <span class="keywordflow">if</span> (objsize&lt;imasize)
00104      {
00105       printf(<span class="stringliteral">"The object has more pixel than the image !! \n"</span>);
00106       exit(0);
00107      }
00108    
00109    <span class="comment">/* Object */</span>
00110    <a class="code" href="jmemsys_8h.html#a3">object</a> = <a class="code" href="group__Object.html#ga8">GetTestObject2D</a>(obj,objsize,objsize,db0);
00111 <span class="comment">// AddNoiseToObject(object,5.0);</span>
00112 <span class="comment">// ApplyMeanToObject(object,3);</span>
00113 
00114    <span class="comment">/* Experience */</span>
00115    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00116    ntx=imasize; nty=ntx; ntz=1;
00117    fovx=0.20; fovy=0.20; fovz=0.0020;
00118    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,fovy,fovz,0.0,0.0,0.0);
00119    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,ntx,nty,ntz,tacq*1e-3);
00120    <a class="code" href="group__Experience.html#ga19">SetResonanceExperience</a>(expr,flagres);
00121    <a class="code" href="group__Experience.html#ga20">SetFlagdechExperience</a>(expr,flagdech);
00122    <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,b0);
00123     <a class="code" href="group__Experience.html#ga16">SetB0DefExperience</a>(expr,b0def);
00124     expr-&gt;<a class="code" href="struct__Experience3D.html#o34">inhomogeneousB1</a> = inhomogeneousB1;
00125 
00126    <span class="comment">/* Sequence */</span>
00127     <a class="code" href="group__Sequence.html#ga18">SetSeqParamTE</a>(&amp;seqparam,TE);
00128    <a class="code" href="group__Sequence.html#ga19">SetSeqParamTR</a>(&amp;seqparam,TR);
00129     <a class="code" href="group__Sequence.html#ga21">SetSeqParamTeta</a>(&amp;seqparam,teta); <span class="comment">/* pour test GE2D */</span>
00130 
00131    <span class="comment">/* Acquisition */</span>
00132    volrf = <a class="code" href="group__Sequence.html#ga23">RunSequence</a>(seqname,&amp;seqparam,<a class="code" href="jmemsys_8h.html#a3">object</a>,expr);
00133 <span class="comment">// WriteVolRF(volrf);</span>
00134     <a class="code" href="group__Object.html#ga11">FreeObject</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>);
00135 <span class="comment">//    AddGaussianNoiseToRFVolume(volrf,0.001);</span>
00136     <span class="keywordflow">if</span> (filter==1)    <a class="code" href="group__Reconstruction.html#ga2">VolRFFiltering</a>(volrf,<a class="code" href="reconstruction_8h.html#a0">HANNING</a>);
00137 
00138    <span class="comment">/* Reconstruction */</span>
00139    volrecmod = <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a>(volrf);
00140     volrf=NULL;<span class="comment">/* Should be an IdVolFree function call, but volrf pointer if already free within IdVolIFFT function ! */</span>
00141 
00142    <span class="comment">/* Save &amp; Display */</span>
00143 <span class="preprocessor">#ifdef HAVE_MPI</span>
00144 <span class="preprocessor"></span>   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00145    <span class="keywordflow">if</span> (rank==0)  <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,fileout);
00146 <span class="preprocessor">#else</span>
00147 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (display==1) <a class="code" href="group__Display.html#ga5">DisplayVolXY</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)volrecmod,0,<span class="stringliteral">"Recvol2D"</span>); 
00148    <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,fileout);
00149 <span class="preprocessor">#endif</span>
00150 <span class="preprocessor"></span>   printf(<span class="stringliteral">"min=%e max=%e \n"</span>,<a class="code" href="volmin_8c.html#a7">IdVolMinima</a>(volrecmod),<a class="code" href="volmax_8c.html#a11">IdVolMaxima</a>(volrecmod));
00151    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrecmod);
00152 
00153    printf(<span class="stringliteral">"TestSequence2D End\n"</span>);  
00154   }
00155 
<a name="l00178"></a><a class="code" href="group__Test.html#ga1">00178</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga1">TestSequence3D</a>(<span class="keywordtype">int</span> obj,<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> imasize,<span class="keywordtype">double</span> tacq,<span class="keywordtype">double</span> TE, <span class="keywordtype">double</span> TR,<span class="keywordtype">double</span> teta,
00179                <span class="keywordtype">double</span> b0, <span class="keywordtype">double</span> db0,<span class="keywordtype">double</span> b0def,<span class="keywordtype">int</span> flagres,<span class="keywordtype">int</span> flagdech,<span class="keywordtype">int</span> filter,
00180                <span class="keywordtype">char</span> * fileout,<span class="keywordtype">char</span> * seqname,<span class="keywordtype">int</span> display)
00181   {
00182     <span class="keywordtype">char</span> fic[80];
00183     <span class="keywordtype">int</span> ntx, nty, ntz;     <span class="comment">/* Taille du volume RF acquis */</span>
00184     <span class="keywordtype">double</span> fovx,fovy,fovz; <span class="comment">/* Taille du fov en cm */</span>
00185     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00186    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> *expr;
00187    <a class="code" href="sequence_8h.html#a0">SEQPARAM</a> seqparam;
00188     <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>  volrf;
00189    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> volrecmod; 
00190 <span class="preprocessor">#ifdef HAVE_MPI</span>
00191 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00192 <span class="preprocessor">#endif</span>
00193 <span class="preprocessor"></span>    fic[0]=<span class="charliteral">'\0'</span>;
00194 
00195    printf(<span class="stringliteral">"TestSequence3D start\n"</span>);   
00196     
00197    <span class="keywordflow">if</span> (objsize&lt;imasize)
00198      {
00199       printf(<span class="stringliteral">"L'object est plus petit que l'image !! \n"</span>);
00200       exit(0);
00201      }
00202 
00203    <span class="comment">/* Object */</span>   
00204    <a class="code" href="jmemsys_8h.html#a3">object</a>= <a class="code" href="group__Object.html#ga9">GetTestObject3D</a>(obj,objsize,objsize,objsize,db0);
00205 <span class="comment">// AddNoiseToObject(object,5.0);</span>
00206 <span class="comment">// ApplyMeanToObject(object,3);</span>
00207 
00208    <span class="comment">/* Experience */</span>
00209    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00210    ntx=imasize; nty=ntx; ntz=ntx;
00211    fovx=0.20; fovy=0.20; fovz=0.20;
00212    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,fovy,fovz,0.0,0.0,0.0);
00213    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,ntx,nty,ntz,tacq*1e-3);
00214    <a class="code" href="group__Experience.html#ga19">SetResonanceExperience</a>(expr,flagres);
00215    <a class="code" href="group__Experience.html#ga20">SetFlagdechExperience</a>(expr,flagdech);
00216    <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,b0);
00217     <a class="code" href="group__Experience.html#ga16">SetB0DefExperience</a>(expr,b0def);
00218 
00219    <span class="comment">/* Sequence */</span>
00220     <a class="code" href="group__Sequence.html#ga18">SetSeqParamTE</a>(&amp;seqparam,TE);
00221    <a class="code" href="group__Sequence.html#ga19">SetSeqParamTR</a>(&amp;seqparam,TR);
00222     <a class="code" href="group__Sequence.html#ga21">SetSeqParamTeta</a>(&amp;seqparam,teta);
00223 
00224    <span class="comment">/* Acquisition */</span>
00225    volrf = <a class="code" href="group__Sequence.html#ga23">RunSequence</a>(seqname,&amp;seqparam,<a class="code" href="jmemsys_8h.html#a3">object</a>,expr);
00226     <a class="code" href="group__Object.html#ga11">FreeObject</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>);
00227 <span class="comment">// WriteVolRF(volrf);</span>
00228 <span class="comment">//    AddGaussianNoiseToRFVolume(volrf,0.001);</span>
00229     <span class="keywordflow">if</span> (filter==1)    <a class="code" href="group__Reconstruction.html#ga2">VolRFFiltering</a>(volrf,<a class="code" href="reconstruction_8h.html#a0">HANNING</a>);
00230 
00231    <span class="comment">/* Reconstruction */</span>
00232    volrecmod = <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a>(volrf);
00233     volrf=NULL; <span class="comment">/* Should be an IdVolFree function call, but volrf pointer if already free within IdVolIFFT function ! */</span>
00234 
00235    <span class="comment">/* Save &amp; Display */</span>
00236 <span class="preprocessor">#ifdef HAVE_MPI</span>
00237 <span class="preprocessor"></span>   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00238    <span class="keywordflow">if</span> (rank==0)
00239       <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"volse3dsimri.acr"</span>);
00240 <span class="preprocessor">#else</span>
00241 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (display==1) <a class="code" href="group__Display.html#ga5">DisplayVolXY</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)volrecmod,0,<span class="stringliteral">"Recvol2D"</span>); 
00242    <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"volse3dsimri.acr"</span>);
00243 <span class="preprocessor">#endif</span>
00244 <span class="preprocessor"></span>   <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrecmod);
00245    
00246    printf(<span class="stringliteral">"TestSequence3D End\n"</span>);  
00247   }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:15 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
