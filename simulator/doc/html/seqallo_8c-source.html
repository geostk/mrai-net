<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: seqallo.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>seqallo.c</h1><a href="seqallo_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: seqallo.c,v 1.1 2005/09/09 08:22:53 bellet Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 1.0  05/09/2005</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00038 
00039 <span class="preprocessor">#include "<a class="code" href="idseq-base_8h.html">idseq-base.h</a>"</span>
00040 <span class="preprocessor">#include "<a class="code" href="idima-private_8h.html">idima-private.h</a>"</span>
00041 
<a name="l00042"></a><a class="code" href="seqallo_8c.html#a0">00042</a> <span class="preprocessor">#define DEBUG 0</span>
00043 <span class="preprocessor"></span>
00044 <span class="comment">/*************************************************************************</span>
00045 <span class="comment">*</span>
00046 <span class="comment">*  Description : Allocation / Destruction d'une structure SEQuence compacte .</span>
00047 <span class="comment">*</span>
00048 <span class="comment">**************************************************************************/</span>
00049 
00062 <a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>
<a name="l00063"></a><a class="code" href="seqallo_8c.html#a1">00063</a> <a class="code" href="seqallo_8c.html#a1">IdSeqAlloc</a>(<span class="keywordtype">int</span> sx, <span class="keywordtype">int</span> sy, <span class="keywordtype">int</span> sz, <span class="keywordtype">int</span> sb, <span class="keywordtype">int</span> ty)
00064 {
00065    <a class="code" href="structPRIVATE__SEQUENCE.html">PRIVATE_SEQUENCE</a> *pseq;
00066    <a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a> pv = NULL;
00067    <span class="keywordtype">int</span> ibloc, iplan, iligne;
00068 
00069    <span class="keywordflow">if</span> (!(ty &amp; <a class="code" href="idgen_8h.html#a6">IDO_TYPE</a>) == <a class="code" href="idgen_8h.html#a9">SEQ</a>) {
00070       printf
00071           (<span class="stringliteral">"Allocation impossible. Objet de type incompatible."</span>);
00072       <span class="keywordflow">return</span> (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) 0;
00073    }
00074 
00075    pseq = (<a class="code" href="structPRIVATE__SEQUENCE.html">PRIVATE_SEQUENCE</a> *)
00076        calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structPRIVATE__SEQUENCE.html">PRIVATE_SEQUENCE</a>) + sb * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> ***));
00077 
00078    <span class="keywordflow">if</span> (pseq ==NULL) {
00079          printf
00080           (<span class="stringliteral">"Echec d'allocation PRIVATE_SEQUENCE."</span>);
00081           <span class="keywordflow">return</span> (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) NULL;
00082    }
00083    
00084    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"pseq %p\n"</span>,pseq);
00085 
00086    
00087    pseq-&gt;<a class="code" href="structPRIVATE__SEQUENCE.html#o11">_fichier</a> = 0;
00088    pseq-&gt;<a class="code" href="structPRIVATE__SEQUENCE.html#o10">_message</a> = 0;
00089    pv = (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) &amp; pseq[1];
00090 
00091    <a class="code" href="idseq-ido_8h.html#a21">IdSeqDimX</a>(pv) = sx;
00092    <a class="code" href="idseq-ido_8h.html#a22">IdSeqDimY</a>(pv) = sy;
00093    <a class="code" href="idseq-ido_8h.html#a23">IdSeqDimZ</a>(pv) = sz;
00094    <a class="code" href="idseq-ido_8h.html#a24">IdSeqDimT</a>(pv) = sb;
00095 
00096    <a class="code" href="idseq-ido_8h.html#a25">IdSeqUsedNbX</a>(pv) = 0;
00097    <a class="code" href="idseq-ido_8h.html#a26">IdSeqUsedNbY</a>(pv) = 0;
00098    <a class="code" href="idseq-ido_8h.html#a27">IdSeqUsedNbZ</a>(pv) = 0;
00099    <a class="code" href="idseq-ido_8h.html#a28">IdSeqUsedNbT</a>(pv) = 0;
00100 
00101    <a class="code" href="idseq-ido_8h.html#a37">IdSeqType</a>(pv)   = ty;
00102    pseq-&gt;<a class="code" href="structPRIVATE__SEQUENCE.html#o4">subObject</a> = 0;
00103    
00104       <span class="comment">/*</span>
00105 <span class="comment">       * Gestion du cas des sequences de bits</span>
00106 <span class="comment">       */</span>
00107    sx = ((ty &amp; <a class="code" href="idgen_8h.html#a18">TY_SIZE</a>) == <a class="code" href="idgen_8h.html#a35">TY_BIT</a>) ? ((sx + 7) &gt;&gt; 3) : sx;
00108 
00109    pv[0] = (<span class="keywordtype">void</span> ***) malloc( sb * sz * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
00110    
00111    <span class="keywordflow">if</span> (pv[0] == NULL) {
00112       printf(<span class="stringliteral">"Echec Alloc Sequence (pointeurs sur Plans)\n"</span>);
00113       free(pseq);
00114       <span class="keywordflow">return</span> (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) NULL;
00115    }
00116    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"IdSeqAlloc : pv[0] : %p\n"</span>, pv[0]);
00117    
00118    pv[0][0] = (<span class="keywordtype">void</span> **) malloc( sb * sz * sy * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *) );
00119 
00120    <span class="keywordflow">if</span> (pv[0][0] == NULL) {
00121       printf(<span class="stringliteral">"Echec Alloc Sequence (pointeurs sur Lignes)\n"</span>);
00122       free(pv[0]);
00123       free(pseq);    
00124       <span class="keywordflow">return</span> (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) NULL;
00125    }
00126    
00127    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"IdSeqAlloc : pv[0][0] : %p\n"</span>, pv[0][0]);
00128 
00129    pv[0][0][0] = (<span class="keywordtype">void</span> *) malloc( sb * sz * sy * sx * <a class="code" href="idgen_8h.html#a86">IdSizeOfType</a>(pv));
00130 
00131    <span class="keywordflow">if</span> (pv[0][0][0] == NULL) {
00132       printf(<span class="stringliteral">"Echec Alloc Sequence (seqxels)\n"</span>);
00133       free(pv[0][0]);            
00134       free(pv[0]);            
00135       free(pseq);
00136       <span class="keywordflow">return</span> (<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a>) NULL;
00137    }
00138    
00139    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"IdSeqAlloc : pv[0][0][0] : %p\n"</span>, pv[0][0][0]);
00140 
00141    <span class="keywordflow">for</span> (ibloc = 0; ibloc &lt; sb; ibloc++) {
00142       pv[ibloc]= pv[0] + ibloc * sz;
00143       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"ibloc : pv[%d] %p\n"</span>, ibloc, pv[ibloc]);
00144    }
00145          
00146    <span class="keywordflow">for</span> (ibloc = 0; ibloc &lt; sb; ibloc++) { 
00147       <span class="keywordflow">for</span> (iplan = 0; iplan &lt; sz; iplan++) {
00148          pv[ibloc][iplan]= pv[0][0] + (ibloc*sz + iplan) * sy;
00149          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"  plan : pv[%d][%d] %p \n"</span>, ibloc, iplan,pv[ibloc][iplan]);
00150          
00151       }
00152    }
00153 
00154    <span class="keywordflow">for</span> (ibloc = 0; ibloc &lt; sb; ibloc++) { 
00155       <span class="keywordflow">for</span> (iplan = 0; iplan &lt; sz; iplan++) {
00156          <span class="keywordflow">for</span> (iligne=0; iligne&lt;sy; iligne++) {     
00157             pv[ibloc][iplan][iligne] = (( (<span class="keywordtype">char</span> *)pv[0][0][0]) 
00158                   + ((ibloc*sz + iplan) * sy + iligne )*sx*<a class="code" href="idgen_8h.html#a86">IdSizeOfType</a>(pv) );
00159             <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"     iligne :  pv[%d][%d][%d] %p\n"</span>, 
00160                         ibloc, iplan, iligne, pv[ibloc][iplan][iligne]);
00161          }
00162       }
00163    }
00164    <span class="keywordflow">return</span> (pv);
00165 }
00166 
00167 
00173 <span class="keywordtype">void</span>
<a name="l00174"></a><a class="code" href="seqallo_8c.html#a2">00174</a> <a class="code" href="seqallo_8c.html#a2">_IdSeqFree</a>(PPPPSEQUENCE * pv)
00175 {
00176    <span class="keywordflow">if</span> (*pv) {
00177       <span class="keywordflow">if</span> (<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv)-&gt;subObject == 0) {
00178          <span class="comment">/*</span>
00179 <span class="comment">          *Liberation des seqxels si PAS un ss-objet </span>
00180 <span class="comment">          */</span>
00181          <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation des seqxels car PAS un ss-objet\n"</span>); 
00182          free((*pv)[0][0][0]);
00183       }
00184       
00185       <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation Pointeurs Plans\n"</span>);     
00186       free((*pv)[0][0]);
00187       <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation Pointeurs Volumes\n"</span>); 
00188       free((*pv)[0]);
00189       <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"fin Liberation Pointeurs Volumes\n"</span>);
00190       
00191       <span class="keywordflow">if</span> (<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv)-&gt;_message) {
00192          <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation _message\n"</span>); 
00193          free((<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv)-&gt;_message));
00194       }
00195          
00196       <span class="keywordflow">if</span> (<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv)-&gt;_fichier) {
00197          <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation _fichier\n"</span>); 
00198          free((<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv)-&gt;_fichier));
00199       }
00200       <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"Liberation _IdSeqPrivate\n"</span>); 
00201       free(<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(*pv));
00202       *pv = 0;
00203    }
00204 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:15 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
