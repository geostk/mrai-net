<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: test-rmn.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>test-rmn.c</h1><a href="test-rmn_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: test-rmn.c,v 1.28 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment">This file contains several functions that run 1D RMN experience like FID,</span>
00005 <span class="comment">Train of spin echoes, train of gradient echoes ...</span>
00006 <span class="comment">**************************************************************************</span>
00007 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00008 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00009 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00010 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00011 <span class="comment">  "http://www.cecill.info". </span>
00012 <span class="comment">  </span>
00013 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00014 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00015 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00016 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00017 <span class="comment">  liability. </span>
00018 <span class="comment">  </span>
00019 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00020 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00021 <span class="comment">  software by the user in light of its specific status of free software,</span>
00022 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00023 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00024 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00025 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00026 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00027 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00028 <span class="comment">  same conditions as regards security. </span>
00029 <span class="comment">  </span>
00030 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00031 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00034 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00035 <span class="comment">  </span>
00036 <span class="comment">  Version 2.0  20/12/2006</span>
00037 <span class="comment"></span>
00038 <span class="comment">*************************************************************************/</span>
00039 <span class="preprocessor">#include "<a class="code" href="test-rmn_8h.html">test-rmn.h</a>"</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="idvol_8h.html">idvol.h</a>&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="idacr_8h.html">idacr.h</a>&gt;</span>
00042 <span class="preprocessor">#include "<a class="code" href="simri3d_8h.html">simri3d.h</a>"</span>
00043 <span class="preprocessor">#include "<a class="code" href="experience_8h.html">experience.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="object_8h.html">object.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="object-simple_8h.html">object-simple.h</a>"</span>
00046 <span class="preprocessor">#include "<a class="code" href="output_8h.html">output.h</a>"</span>
00047 <span class="preprocessor">#include "<a class="code" href="display_8h.html">display.h</a>"</span>
00048 <span class="preprocessor">#include "<a class="code" href="event-rfpulse_8h.html">event-rfpulse.h</a>"</span>
00049 <span class="preprocessor">#include "<a class="code" href="event-precession_8h.html">event-precession.h</a>"</span>
00050 <span class="preprocessor">#include "<a class="code" href="event-acquisition_8h.html">event-acquisition.h</a>"</span>
00051 
00052 <span class="preprocessor">#ifdef HAVE_MPI</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mpi.h&gt;</span>
00054 <span class="preprocessor">#endif</span>
00055 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="group__Test.html#ga0">00064</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga0">TestFID1D</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize)
00065   {
00066     <span class="keywordtype">char</span> fic[80];
00067    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00068     <span class="keywordtype">double</span> fovx,fovy,fovz; 
00069    <span class="keywordtype">double</span> Tacq;            <span class="comment">/* in s */</span>
00070     <span class="keywordtype">int</span> ro,t1,t2;
00071    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00072    <span class="keywordtype">int</span> tacq;
00073     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00074    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00075     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00076     <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>  volrf;
00077    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> volrecmod,volz,voly; 
00078 <span class="preprocessor">#ifdef HAVE_MPI</span>
00079 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00080 <span class="preprocessor">#endif</span>
00081 <span class="preprocessor"></span>    fic[0]=<span class="charliteral">'\0'</span>;
00082    printf(<span class="stringliteral">"Start TestFID1D \n"</span>); 
00083       event = &amp;event_r;
00084    expr = <a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00085    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00086     t1=150; t2=200; ro=10;
00087    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00088    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00089    fovx=0.20; fovy=0.00020; fovz=0.00020;
00090 
00091     <span class="comment">/* T2* weighting */</span>
00092    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,0.0000001);
00093 
00094     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.5);
00095     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00096    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00097     tacq=800; <span class="comment">/* in ms */</span>
00098    Tacq = tacq * 1.e-3; <span class="comment">/* conversion in s */</span>
00099     <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,Tacq);
00100     acq_delay=0;
00101 
00102    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00103 
00104    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90., 300.);
00105    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a9">PLUS</a>);
00106    
00107    <span class="comment">/* Vizualisation of the T2* decay */</span>
00108    voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00109     <a class="code" href="group__Display.html#ga6">DisplayVolX</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)voly,0,0,<span class="stringliteral">"Antenne Y"</span>,0,<span class="stringliteral">""</span>);
00110    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00111     <span class="comment">/* Vizualisation of the T1 growing*/</span>
00112    volz=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,2);
00113   
00114    event = &amp;event_r;
00115    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00116 
00117     <a class="code" href="group__Display.html#ga6">DisplayVolX</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)volz,0,0,<span class="stringliteral">"Antenne Z"</span>,0,<span class="stringliteral">""</span>);
00118    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volz);
00119 
00120    volrf = <a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr);
00121    <a class="code" href="group__Experience.html#ga6">FreeExperience</a>(expr);
00122 
00123     volrecmod = <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a>(volrf);
00124     volrf=NULL; 
00125    
00126 <span class="preprocessor">#ifdef HAVE_MPI</span>
00127 <span class="preprocessor"></span>   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00128    <span class="keywordflow">if</span> (rank==0)
00129       <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00130 <span class="preprocessor">#else</span>
00131 <span class="preprocessor"></span>   <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00132 <span class="preprocessor">#endif</span>
00133 <span class="preprocessor"></span>   <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrecmod);
00134    
00135    printf(<span class="stringliteral">"End TestFID1D \n"</span>);   
00136   }
00137 
<a name="l00146"></a><a class="code" href="group__Test.html#ga1">00146</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga1">TestEchoSpin1D</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize)
00147   {
00148     <span class="keywordtype">char</span> fic[80];
00149    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00150     <span class="keywordtype">double</span> fovx,fovy,fovz; 
00151    <span class="keywordtype">int</span> ro,t1,t2;
00152    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00153    <span class="keywordtype">double</span> TE,t;
00154    <span class="keywordtype">double</span> timp; <span class="comment">/* in ms */</span>
00155    <span class="keywordtype">int</span> tacq; <span class="comment">/* in ms */</span>
00156     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00157    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00158     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00159     <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>  volrf;
00160    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> volrecmod,voly; 
00161 <span class="preprocessor">#ifdef HAVE_MPI</span>
00162 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00163 <span class="preprocessor">#endif</span>
00164 <span class="preprocessor"></span>  
00165    event = &amp;event_r;
00166    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00167 
00168     fic[0]=<span class="charliteral">'\0'</span>;
00169    printf(<span class="stringliteral">"Sart EchoSpin1D \n"</span>); 
00170 
00171    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00172     t1=500; t2=300; ro=77;
00173    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00174    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00175    fovx=0.20; fovy=0.00020; fovz=0.00020;
00176     
00177    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,1.e-5);
00178     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.);
00179     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00180    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00181     tacq=10; <span class="comment">/* en ms */</span>
00182    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,(tacq * 1.e-3));
00183     acq_delay=0.;
00184     
00185    timp=300.;
00186    TE=20.;
00187    t=TE/2; <span class="comment">/* equals TE/2 in ms */</span>
00188 
00189    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00190    printf(<span class="stringliteral">"Mo=%lf \n"</span>,expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[2][objsize/2][0][0]*objsize);
00191 
00192    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00193    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t-timp*1.e-3);
00194    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00195    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t+timp*1.e-3-(tacq/2.+tacq/2./sigsize));
00196   
00197    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00198    
00199    voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00200     <a class="code" href="group__Display.html#ga6">DisplayVolX</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)voly,0,0,<span class="stringliteral">"Antenne Y"</span>,0,<span class="stringliteral">""</span>);
00201    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00202 
00203    volrf = <a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr);
00204    <a class="code" href="group__Experience.html#ga6">FreeExperience</a>(expr);
00205 
00206     volrecmod = <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a>(volrf);
00207     volrf=NULL; 
00208    
00209 <span class="preprocessor">#ifdef HAVE_MPI</span>
00210 <span class="preprocessor"></span>   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00211    <span class="keywordflow">if</span> (rank==0)
00212       <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00213 <span class="preprocessor">#else</span>
00214 <span class="preprocessor"></span>   <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00215 <span class="preprocessor">#endif</span>
00216 <span class="preprocessor"></span>   <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrecmod);
00217    
00218    printf(<span class="stringliteral">"End TestEchoSpin1D \n"</span>); 
00219   }
00220 
<a name="l00229"></a><a class="code" href="group__Test.html#ga2">00229</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga2">TestEchoGradient1D</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize)
00230   {
00231     <span class="keywordtype">char</span> fic[80];
00232    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00233     <span class="keywordtype">double</span> fovx,fovy,fovz; 
00234    <span class="keywordtype">int</span> ro,t1,t2;
00235    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00236    <span class="keywordtype">double</span> tgp,TE,teta,gx;
00237    <span class="keywordtype">double</span> timp; <span class="comment">/* in ms */</span>
00238    <span class="keywordtype">int</span> tacq; <span class="comment">/* in ms */</span>
00239     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00240    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00241     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00242     <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>  volrf;
00243    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> volrecmod,voly; 
00244 <span class="preprocessor">#ifdef HAVE_MPI</span>
00245 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00246 <span class="preprocessor">#endif</span>
00247 <span class="preprocessor"></span>  
00248    event = &amp;event_r;
00249    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00250 
00251     fic[0]=<span class="charliteral">'\0'</span>;
00252    printf(<span class="stringliteral">"Sart EchoGradient1D \n"</span>);   
00253 
00254    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00255     t1=500; t2=300; ro=77;
00256    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00257    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00258    fovx=0.20; fovy=0.00020; fovz=0.00020;
00259     
00260    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,1.e-6);
00261     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.);
00262     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00263    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00264     tacq=10; <span class="comment">/* in ms */</span>
00265    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,(tacq * 1.e-3));
00266     acq_delay=0.;
00267    gx=(sigsize-2)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;
00268    gx = gx * 1.0; <span class="comment">/* Gradient effect weighting on the decay */</span>
00269    timp=300.;
00270 
00271    TE=20.;
00272    tgp=TE-timp*1.e-3-tacq/2.0-tacq/2.0; 
00273     teta=90.0;
00274 
00275    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00276    printf(<span class="stringliteral">"Mo=%lf \n"</span>,expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[2][objsize/2][0][0]*objsize);
00277    
00278    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,teta,timp);
00279    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tgp);
00280    <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event,tacq/2.0,-gx,0.0,0.0);
00281    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,gx,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a9">PLUS</a>);
00282    
00283    voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00284     <a class="code" href="group__Display.html#ga6">DisplayVolX</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)voly,0,0,<span class="stringliteral">"Antenne Y"</span>,0,<span class="stringliteral">""</span>);
00285    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00286 
00287    volrf = <a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr);
00288    <a class="code" href="group__Experience.html#ga6">FreeExperience</a>(expr);
00289 
00290     volrecmod = <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a>(volrf);
00291     volrf=NULL; 
00292    
00293 <span class="preprocessor">#ifdef HAVE_MPI</span>
00294 <span class="preprocessor"></span>   MPI_Comm_rank(MPI_COMM_WORLD,&amp;rank);
00295    <span class="keywordflow">if</span> (rank==0)
00296       <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00297 <span class="preprocessor">#else</span>
00298 <span class="preprocessor"></span>   <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(volrecmod,<span class="stringliteral">"imafid1dsimri.acr"</span>);
00299 <span class="preprocessor">#endif</span>
00300 <span class="preprocessor"></span>   <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrecmod);
00301    
00302    printf(<span class="stringliteral">"End TestEchoGradient1D \n"</span>);   
00303   }
00304 
<a name="l00313"></a><a class="code" href="group__Test.html#ga2">00313</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga2">TestTrainEchoSpin1D</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize,<span class="keywordtype">int</span> nbecho)
00314   {
00315     <span class="keywordtype">char</span> fic[80];
00316    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,i;
00317     <span class="keywordtype">double</span> fovx,fovy,fovz;
00318    <span class="keywordtype">int</span> ro,t1,t2;
00319    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00320    <span class="keywordtype">double</span> TE,t;
00321    <span class="keywordtype">double</span> timp; <span class="comment">/* in ms */</span>
00322    <span class="keywordtype">int</span> tacq; <span class="comment">/* in ms */</span>
00323     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00324    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00325     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00326    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> voly; 
00327 <span class="preprocessor">#ifdef HAVE_MPI</span>
00328 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00329 <span class="preprocessor">#endif</span>
00330 <span class="preprocessor"></span>  
00331    event = &amp;event_r;
00332    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00333 
00334     fic[0]=<span class="charliteral">'\0'</span>;
00335    printf(<span class="stringliteral">"Start TrainEchoSpin1D \n"</span>); 
00336 
00337    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00338     t1=250; t2=300; ro=10;
00339    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00340    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00341    fovx=0.20; fovy=0.00020; fovz=0.00020;
00342     
00343    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,0.00001);
00344     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.);
00345     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00346    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00347     tacq=10; <span class="comment">/* in ms */</span>
00348    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,(tacq * 1.e-3));
00349     acq_delay=0.;
00350     
00351    timp=3.;
00352    TE=100.;
00353    t=TE/2; <span class="comment">/* corresponds to TE/2 in ms */</span>
00354 
00355    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00356    
00357    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00358    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t-timp*1.e-3);
00359    
00360    <span class="keywordflow">for</span> (i=1;i&lt;=nbecho;i++)
00361    {
00362     <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00363     <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t+timp*1.e-3-(tacq/2.+tacq/2./sigsize));
00364     <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00365     <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t+timp*1.e-3-(tacq/2.+tacq/2./sigsize));
00366 
00367     voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00368     <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00369    }
00370    printf(<span class="stringliteral">"End TestTrainEchoSpin1D \n"</span>);  
00371   }
00372 
<a name="l00382"></a><a class="code" href="group__Test.html#ga4">00382</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga4">TestTrainEchoGradient1D</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize,<span class="keywordtype">int</span> nbecho)
00383   {
00384     <span class="keywordtype">char</span> fic[80];
00385    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,i;
00386     <span class="keywordtype">double</span> fovx,fovy,fovz;
00387    <span class="keywordtype">int</span> ro,t1,t2,s;
00388    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00389    <span class="keywordtype">double</span> TE;
00390    <span class="keywordtype">double</span> timp,gx,teta,tgp; <span class="comment">/* in ms */</span>
00391    <span class="keywordtype">int</span> tacq; <span class="comment">/* in ms */</span>
00392     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00393    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00394     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00395    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> voly; 
00396 <span class="preprocessor">#ifdef HAVE_MPI</span>
00397 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00398 <span class="preprocessor">#endif</span>
00399 <span class="preprocessor"></span>  
00400    event = &amp;event_r;
00401    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00402 
00403     fic[0]=<span class="charliteral">'\0'</span>;
00404    printf(<span class="stringliteral">"Start TrainEchoGradient1D \n"</span>);   
00405 
00406    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00407     t1=500; t2=300; ro=77;
00408    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00409    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00410    fovx=0.20; fovy=0.00020; fovz=0.00020;
00411     
00412    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,1.e-6);
00413     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.);
00414    <span class="comment">/* */</span>
00415     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00416    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00417     tacq=10; <span class="comment">/* en ms */</span>
00418    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,(tacq * 1.e-3));
00419     acq_delay=0.;
00420    gx=(sigsize-2)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;
00421    timp=300.;
00422 
00423    TE=20.;
00424    tgp=TE-timp*1.e-3-tacq/2.0-tacq/2.0; 
00425     teta=90.0;
00426 
00427    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00428    printf(<span class="stringliteral">"Mo=%lf \n"</span>,expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[2][objsize/2][0][0]*objsize);
00429    
00430    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,teta,timp);
00431    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tgp);
00432    <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event,tacq/2.0,-gx,0.0,0.0);
00433    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,gx,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a9">PLUS</a>);
00434     voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00435    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);  
00436    s=1;
00437    <span class="keywordflow">for</span> (i=1;i&lt;=nbecho;i++)
00438    {
00439     s= s*(-1);
00440     <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,s*gx,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a9">PLUS</a>);
00441     getchar();
00442     voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00443     <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00444    }
00445    
00446    printf(<span class="stringliteral">"End TestTrainEchoGradient1D \n"</span>); 
00447   }
00448 
<a name="l00457"></a><a class="code" href="group__Test.html#ga3">00457</a> <span class="keywordtype">void</span> <a class="code" href="group__Test.html#ga3">TestSimulatedEcho</a>(<span class="keywordtype">int</span> objsize,<span class="keywordtype">int</span> sigsize)
00458   {
00459     <span class="keywordtype">char</span> fic[80];
00460    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00461     <span class="keywordtype">double</span> fovx,fovy,fovz;
00462    <span class="keywordtype">int</span> ro,t1,t2;
00463    <span class="keywordtype">double</span> acq_delay; <span class="comment">/* in ms */</span>
00464    <span class="keywordtype">double</span> TE,t,TM;
00465    <span class="keywordtype">double</span> timp; <span class="comment">/* in ms */</span>
00466    <span class="keywordtype">double</span> alpha1,alpha2,alpha3;
00467    <span class="keywordtype">int</span> tacq; <span class="comment">/* in ms */</span>
00468     <a class="code" href="object_8h.html#a7">OBJECT3D</a>  *<a class="code" href="jmemsys_8h.html#a3">object</a>;
00469    <a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr;
00470     <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00471    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> voly; 
00472 <span class="preprocessor">#ifdef HAVE_MPI</span>
00473 <span class="preprocessor"></span>    <span class="keywordtype">int</span> rank;
00474 <span class="preprocessor">#endif</span>
00475 <span class="preprocessor"></span>
00476    
00477    event = &amp;event_r;
00478    expr=<a class="code" href="group__Experience.html#ga0">AllocExperience</a>();
00479 
00480     fic[0]=<span class="charliteral">'\0'</span>;
00481    printf(<span class="stringliteral">"Start TestSimulatedEcho \n"</span>);  
00482 
00483    <a class="code" href="jerror_8h.html#a52a35">x</a>=objsize; y=1; z=1;
00484     t1=250; t2=300; ro=10;
00485    <a class="code" href="jmemsys_8h.html#a3">object</a>=<a class="code" href="group__Object.html#ga0">CreateHomogeneousObject</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,t1,t2,ro);
00486    <a class="code" href="group__Object.html#ga15">SetObjectSize</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,(<span class="keywordtype">float</span>)0.2,(<span class="keywordtype">float</span>)0.0002,(<span class="keywordtype">float</span>)0.0002);
00487    fovx=0.20; fovy=0.00020; fovz=0.00020;
00488     
00489    <a class="code" href="group__Object.html#ga16">SetObjectDeltaB0</a>(<a class="code" href="jmemsys_8h.html#a3">object</a>,0.00001);
00490     <a class="code" href="group__Experience.html#ga15">SetB0Experience</a>(expr,1.5);
00491     <a class="code" href="group__Experience.html#ga21">SetObjectExperienceComponent</a>(expr,<a class="code" href="jmemsys_8h.html#a3">object</a>,<a class="code" href="object_8h.html#a0">WATER</a>,0);
00492    <a class="code" href="group__Experience.html#ga22">SetFovExperience</a>(expr,fovx,1,1,0,0,0);     
00493     tacq=10; <span class="comment">/* in ms */</span>
00494    <a class="code" href="group__Experience.html#ga24">SetAcqExperience</a>(expr,sigsize,1,1,(tacq * 1.e-3));
00495     
00496     acq_delay=0.;
00497    timp=3.;
00498    alpha1=90.;
00499    alpha2=180;
00500    alpha3=180;
00501 
00502    TE=80.;
00503    TM=100.; <span class="comment">/* Mixin gtime */</span>
00504    t=TE/2; <span class="comment">/* corresponds to TE/2 in ms */</span>
00505 
00506    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>);
00507    
00508    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,alpha1,timp);
00509    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t-timp*1.e-3); <span class="comment">/* waiting of TE/2 */</span>
00510    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,alpha2,timp);
00511     <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t+timp*1.e-3-(tacq/2.+tacq/2./sigsize));
00512    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00513        voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00514        <span class="comment">//DisplayVolX((PPPVOLUME)voly,0,0,"Echo spin 1-2",0,"");</span>
00515        <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00516 
00517    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,TM-(t+tacq/2.));  <span class="comment">/* 55 */</span>
00518    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,alpha3,timp);
00519     <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t+timp*1.e-3-(tacq/2.+tacq/2./sigsize)); <span class="comment">/* 35 */</span>
00520    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00521        voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00522        <span class="comment">//DisplayVolX((PPPVOLUME)voly,0,0,"Echo stimule 1-2-3",0,"");</span>
00523        <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00524     
00525    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,TM-t-(tacq/2.)-t-tacq/2.0);  <span class="comment">/*10*/</span>
00526    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00527        voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00528        <span class="comment">//DisplayVolX((PPPVOLUME)voly,0,0,"Echo spin 1-2-3",0,"");</span>
00529        <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00530     
00531    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t-tacq/2.0-(tacq/2.+tacq/2./sigsize)); <span class="comment">/* 30 */</span>
00532    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00533        voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00534        <span class="comment">//DisplayVolX((PPPVOLUME)voly,0,0,"Echo spin 2-3",0,"");</span>
00535        <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00536     
00537    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,t-tacq/2.0-(tacq/2.+tacq/2./sigsize)); <span class="comment">/* 30 */</span>
00538    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>(expr,event,0,0,0,acq_delay,<a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00539        voly=<a class="code" href="group__Experience.html#ga27">GetSignalRFComponentFromExperience</a>(expr,1);
00540        <span class="comment">//DisplayVolX((PPPVOLUME)voly,0,0,"Echo spin 1-3",0,"");</span>
00541        <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voly);
00542 
00543    printf(<span class="stringliteral">"End TestSimulatedEcho \n"</span>); 
00544   }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:15 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
