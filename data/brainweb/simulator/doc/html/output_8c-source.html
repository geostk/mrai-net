<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: output.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>output.c</h1><a href="output_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: output.c,v 1.8 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 2.0  20/12/2006</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="preprocessor">#include "<a class="code" href="output_8h.html">output.h</a>"</span>
00037 
<a name="l00045"></a><a class="code" href="group__Output.html#ga0">00045</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga0">WriteVolRF</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrf)
00046 {
00047  <a class="code" href="idvol-ido_8h.html#a38">PPPVOLUME_DOUBLE</a> re,im;
00048  <span class="keywordtype">int</span> i,j,k;
00049  <span class="keywordtype">int</span> X,Y,Z;
00050 
00051  X=<a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrf);
00052  Y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrf);
00053  Z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrf);
00054 
00055  re = (<a class="code" href="idvol-ido_8h.html#a38">PPPVOLUME_DOUBLE</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(X,Y,Z,<a class="code" href="idvol-ido_8h.html#a7">VOL_DOUBLE</a>);
00056  im = (<a class="code" href="idvol-ido_8h.html#a38">PPPVOLUME_DOUBLE</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(X,Y,Z,<a class="code" href="idvol-ido_8h.html#a7">VOL_DOUBLE</a>);
00057  <span class="keywordflow">for</span> (k=0;k&lt;Z;k++) <span class="keywordflow">for</span> (i=0;i&lt;Y;i++) <span class="keywordflow">for</span> (j=0;j&lt;X;j++)
00058  {
00059   re[k][i][j] = volrf[k][i][j].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>;
00060   im[k][i][j] = volrf[k][i][j].im;
00061  }
00062  <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(<span class="stringliteral">"rf_re.vol"</span>,(<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)re);
00063  <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(<span class="stringliteral">"rf_im.vol"</span>,(<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)im);
00064 
00065  <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(re);
00066  <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(im);
00067 
00068 }
00069 
<a name="l00078"></a><a class="code" href="group__Output.html#ga1">00078</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga1">WriteVolRecUchar</a>(PPPVOLUME_FLOAT volrec, <span class="keywordtype">char</span> * volname)
00079 {
00080  <span class="keywordtype">int</span> X,Y,Z;
00081  <a class="code" href="idvol-ido_8h.html#a36">PPPVOLUME_UCHAR</a> voluchar;
00082  <a class="code" href="idima-ido_8h.html#a25">PPIMAGE_UCHAR</a> imauchar;
00083  <span class="keywordtype">double</span> <a class="code" href="idmac_8h.html#a0">min</a>=0.0;
00084  <span class="keywordtype">double</span> <a class="code" href="idmac_8h.html#a1">max</a>=0.0;
00085  <span class="keywordtype">double</span> dyn;
00086  <span class="keywordtype">int</span> i,j,k;
00087 
00088  <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(<span class="stringliteral">"recfloat.raw"</span>,(<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)volrec);
00089  X=<a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrec);
00090  Y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrec);
00091  Z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrec);
00092 
00093  <a class="code" href="volmax_8c.html#a15">IdVolMinMax</a>((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)volrec,&amp;<a class="code" href="idmac_8h.html#a0">min</a>,&amp;<a class="code" href="idmac_8h.html#a1">max</a>);
00094  dyn=(<a class="code" href="idmac_8h.html#a1">max</a>-<a class="code" href="idmac_8h.html#a0">min</a>);
00095  <span class="keywordflow">if</span> (Z==1) <span class="comment">/* Writing a 2D image */</span>
00096    {
00097     imauchar = (<a class="code" href="idima-ido_8h.html#a25">PPIMAGE_UCHAR</a>) <a class="code" href="imaallo_8c.html#a9">IdImaAlloc</a>(X,Y,<a class="code" href="idima-ido_8h.html#a1">IMA_UCHAR</a>);
00098     <span class="keywordflow">for</span> (i=0;i&lt;Y;i++) <span class="keywordflow">for</span> (j=0;j&lt;X;j++)
00099       imauchar[i][j]=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(((volrec[0][i][j]-<a class="code" href="idmac_8h.html#a0">min</a>)/dyn)*255.0+0.5);
00100     <a class="code" href="imawrf_8c.html#a0">IdImaWriteRawFile</a>(volname,(<a class="code" href="idima-ido_8h.html#a23">PPIMAGE</a>)imauchar);
00101     <a class="code" href="idima-base_8h.html#a0">IdImaFree</a>(imauchar);
00102    }
00103  <span class="keywordflow">else</span>
00104    {
00105     voluchar = (<a class="code" href="idvol-ido_8h.html#a36">PPPVOLUME_UCHAR</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(X,Y,Z,<a class="code" href="idvol-ido_8h.html#a1">VOL_UCHAR</a>);
00106     <span class="keywordflow">for</span> (k=0;k&lt;Z;k++) <span class="keywordflow">for</span> (i=0;i&lt;Y;i++) <span class="keywordflow">for</span> (j=0;j&lt;X;j++)
00107       voluchar[k][i][j]=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(((volrec[k][i][j]-<a class="code" href="idmac_8h.html#a0">min</a>)/dyn)*255.0+0.5);
00108     <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(volname,(<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>)voluchar);
00109     <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(voluchar);
00110    }
00111 }
00112 
<a name="l00120"></a><a class="code" href="group__Output.html#ga2">00120</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga2">WriteSignalRFModule</a>(<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> * expr, <span class="keywordtype">char</span> * volname)
00121 {
00122    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> rfmod;
00123 
00124    rfmod = (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="group__Experience.html#ga29">GetSignalRFModuleFromExperience</a>(expr);
00125    <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(volname,(<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>)rfmod);
00126    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(rfmod);
00127 }
00128 
<a name="l00136"></a><a class="code" href="group__Output.html#ga3">00136</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga3">WriteRecIFFTVolumeModule</a>(<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> * expr, <span class="keywordtype">char</span> * volname)
00137 {
00138    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> module;
00139 
00140    module= (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="group__Reconstruction.html#ga6">RecVolIFFTModule</a>(expr);
00141    <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(volname,module);
00142    
00143    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(module);
00144 }
00145 
<a name="l00153"></a><a class="code" href="group__Output.html#ga4">00153</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga4">WriteRecIFFTVolumePhase</a>(<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> * expr, <span class="keywordtype">char</span> * volname)
00154 {
00155    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> phase;
00156 
00157    phase= (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="group__Reconstruction.html#ga7">RecVolIFFTPhase</a>(expr);
00158    <a class="code" href="volwrf_8c.html#a0">IdVolWriteRawFile</a>(volname,phase);
00159    
00160    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(phase);
00161 }
00162 
<a name="l00171"></a><a class="code" href="group__Output.html#ga5">00171</a> <span class="keywordtype">void</span> <a class="code" href="group__Output.html#ga5">MagstateWatch</a>(<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>* expr,<span class="keywordtype">char</span> * filename)
00172 {
00173 <span class="keywordtype">int</span> g,ii;
00174 FILE *fic;
00175 <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y;
00176 
00177 <a class="code" href="jerror_8h.html#a52a35">x</a>=expr-&gt;<a class="code" href="struct__Experience3D.html#o5">nfovx</a>/2;
00178 y=expr-&gt;<a class="code" href="struct__Experience3D.html#o6">nfovy</a>/2;
00179 fic=fopen(filename,<span class="stringliteral">"w"</span>);
00180 <span class="keywordflow">for</span>(g=0;g&lt;expr-&gt;<a class="code" href="struct__Experience3D.html#o7">nfovz</a>;g++)
00181    {
00182    <span class="keywordflow">for</span>(ii=0;ii&lt;=2;ii++) 
00183       {
00184        fprintf(fic,<span class="stringliteral">"%lf "</span>,expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[ii][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g]);
00185       }
00186    fprintf(fic,<span class="stringliteral">"%lf "</span>,sqrt(expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[0][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g]*expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[0][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g]+expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[1][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g]*expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[1][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g]));
00187    fprintf(fic,<span class="stringliteral">"%lf "</span>,atan2(expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[1][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g],expr-&gt;<a class="code" href="struct__Experience3D.html#o23">magstate</a>[0][<a class="code" href="jerror_8h.html#a52a35">x</a>][y][g])*180/M_PI);
00188    fprintf(fic,<span class="stringliteral">"\n"</span>);
00189    }
00190 fclose(fic);
00191 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:14 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
