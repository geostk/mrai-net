<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: reconstruction.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>reconstruction.c</h1><a href="reconstruction_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: reconstruction.c,v 1.19 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 2.0  20/12/2006</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="preprocessor">#include "<a class="code" href="reconstruction_8h.html">reconstruction.h</a>"</span>
00037 
00038 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00039 <span class="preprocessor">#include &lt;math.h&gt;</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="idsig_8h.html">idsig.h</a>&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="idima_8h.html">idima.h</a>&gt;</span>
00042 <span class="preprocessor">#include &lt;<a class="code" href="idvol_8h.html">idvol.h</a>&gt;</span>
00043 <span class="preprocessor">#include &lt;<a class="code" href="iderr_8h.html">iderr.h</a>&gt;</span>
00044 <span class="preprocessor">#include &lt;<a class="code" href="idprint_8h.html">idprint.h</a>&gt;</span>
<a name="l00053"></a><a class="code" href="group__Reconstruction.html#ga2">00053</a> <span class="keywordtype">void</span> <a class="code" href="group__Reconstruction.html#ga2">VolRFFiltering</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrf,<span class="keywordtype">int</span> type)
00054 {
00055    <span class="keywordtype">int</span> i,j,k;
00056    <span class="keywordtype">double</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00057    <span class="keywordtype">double</span> w,<a class="code" href="jerror_8h.html#a52a25">d</a>;
00058 
00059    <a class="code" href="jerror_8h.html#a52a35">x</a>= (<span class="keywordtype">double</span>) <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrf);
00060    y= (<span class="keywordtype">double</span>) <a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrf);
00061    z= (<span class="keywordtype">double</span>) <a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrf);
00062 
00063 <span class="keywordflow">switch</span>(type)
00064 {
00065 <span class="keywordflow">case</span> 0: <span class="comment">/* Hanning */</span>
00066    {
00067      <span class="keywordflow">if</span> ((<a class="code" href="jerror_8h.html#a52a35">x</a>!=1)&amp;&amp;(y!=1)&amp;&amp;(z!=1)) <span class="comment">/*3D*/</span>
00068     {
00069      <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00070      {
00071        <a class="code" href="jerror_8h.html#a52a25">d</a>=sqrt((i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)*(i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)/<a class="code" href="jerror_8h.html#a52a35">x</a>/<a class="code" href="jerror_8h.html#a52a35">x</a>*4+(j-y/2.)*(j-y/2.)/y/y*4+(k-z/2)*(k-z/2.)/z/z*4);
00072       <span class="keywordflow">if</span> (<a class="code" href="jerror_8h.html#a52a25">d</a>&gt;1.0) <a class="code" href="jerror_8h.html#a52a25">d</a>=1.0;
00073       w=0.5 + 0.5*cos(M_PI*<a class="code" href="jerror_8h.html#a52a25">d</a>);
00074       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a> * w;
00075       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a> * w;
00076      }
00077     }
00078      <span class="keywordflow">if</span> ((<a class="code" href="jerror_8h.html#a52a35">x</a>!=1)&amp;&amp;(y!=1)&amp;&amp;(z==1)) <span class="comment">/*2D*/</span>
00079     {
00080      <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00081      {
00082        <a class="code" href="jerror_8h.html#a52a25">d</a>=sqrt((i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)*(i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)/<a class="code" href="jerror_8h.html#a52a35">x</a>/<a class="code" href="jerror_8h.html#a52a35">x</a>*4+(j-y/2.)*(j-y/2.)/y/y*4);
00083       <span class="keywordflow">if</span> (<a class="code" href="jerror_8h.html#a52a25">d</a>&gt;1.0) <a class="code" href="jerror_8h.html#a52a25">d</a>=1.0;
00084       w=0.5 + 0.5*cos(M_PI*<a class="code" href="jerror_8h.html#a52a25">d</a>);
00085       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a> * w;
00086       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a> * w;
00087      }
00088     }
00089      <span class="keywordflow">if</span> ((<a class="code" href="jerror_8h.html#a52a35">x</a>!=1)&amp;&amp;(y==1)&amp;&amp;(z==1)) <span class="comment">/*1D*/</span>
00090     {
00091      <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00092      {
00093        <a class="code" href="jerror_8h.html#a52a25">d</a>=sqrt((i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)*(i-<a class="code" href="jerror_8h.html#a52a35">x</a>/2.)/<a class="code" href="jerror_8h.html#a52a35">x</a>/<a class="code" href="jerror_8h.html#a52a35">x</a>*4);
00094       w=0.5 + 0.5*cos(M_PI*<a class="code" href="jerror_8h.html#a52a25">d</a>);
00095       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a> * w;
00096       volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a>=volrf[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a> * w;
00097      }
00098     }
00099    } <span class="comment">/* End Hanning */</span>
00100 <span class="keywordflow">case</span> 2:
00101    {
00102    }
00103 <span class="keywordflow">case</span> 3:
00104    {
00105    }
00106 } <span class="comment">/* End switch */</span>
00107 }
00108 
<a name="l00117"></a><a class="code" href="group__Reconstruction.html#ga3">00117</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Reconstruction.html#ga3">RecVolIFFTComplexeFromVol</a> (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrf)
00118 {
00119    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00120    <span class="keywordtype">int</span> i,j,k;
00121    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00122 
00123    volrf= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="volfft_8c.html#a6">IdVolIFFT</a>((<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) volrf);
00124    <span class="comment">/* Careful : volrf output of IFFT is different from the volrf input. Thus it is desalloacted in this function */</span>
00125    
00126    <span class="comment">/* x permutation of the IFFT  */</span>
00127    <a class="code" href="jerror_8h.html#a52a35">x</a>=<a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrf);
00128    y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrf);
00129    z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrf);
00130    volrec = (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a10">VOL_COMPLEX_DOUBLE</a>);
00131    <span class="keywordflow">if</span>(!volrec)
00132     {
00133      printf(<span class="stringliteral">"Impossible d'allouer un volume dans RecVolIFFTComplexe !\n"</span>);
00134      exit(0);
00135      }
00136     <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00137     {
00138      volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>=volrf[k][j][<a class="code" href="jerror_8h.html#a52a35">x</a>-1-i].<a class="code" href="structCOMPLEX.html#o0">re</a>;
00139      volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a>=volrf[k][j][<a class="code" href="jerror_8h.html#a52a35">x</a>-1-i].<a class="code" href="structCOMPLEX.html#o1">im</a>;
00140     }
00141 
00142     <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrf);
00143     <span class="keywordflow">return</span>(volrec);
00144 }
00145 
<a name="l00154"></a><a class="code" href="group__Reconstruction.html#ga4">00154</a> <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTModuleFromVol</a> (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrf)
00155 {
00156    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00157    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> module;
00158    <span class="keywordtype">int</span> i,j,k;
00159    <span class="keywordtype">int</span> it,jt,kt;
00160    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00161    <span class="keywordtype">double</span> a,<a class="code" href="jpegint_8h.html#a21">b</a>;
00162 
00163    volrec= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="group__Reconstruction.html#ga3">RecVolIFFTComplexeFromVol</a>(volrf);
00164    <a class="code" href="jerror_8h.html#a52a35">x</a> = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrec); y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrec); z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrec);
00165 
00166    module = (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a6">VOL_FLOAT</a>);
00167 
00168    <span class="comment">/* Module computation with dimx*dimy*dimz permutations */</span>
00169    <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00170    {
00171       it = (i + (<a class="code" href="jerror_8h.html#a52a35">x</a> / 2)) % <a class="code" href="jerror_8h.html#a52a35">x</a>;
00172       jt = (j + (y / 2)) % y;
00173       kt = (k + (z / 2)) % z;
00174       a = volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>;
00175       <a class="code" href="jpegint_8h.html#a21">b</a> = volrec[k][j][i].im;
00176       module[kt][jt][it] = (<span class="keywordtype">float</span>) sqrt((a*a) + (<a class="code" href="jpegint_8h.html#a21">b</a>*<a class="code" href="jpegint_8h.html#a21">b</a>));
00177    }
00178    
00179    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrec);
00180    
00181    <span class="keywordflow">return</span>(module);
00182 }
00183 
<a name="l00192"></a><a class="code" href="group__Reconstruction.html#ga5">00192</a> <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> <a class="code" href="group__Reconstruction.html#ga5">RecVolIFFTPhaseFromVol</a> (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrf)
00193 {
00194    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00195    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> phase;
00196    <span class="keywordtype">int</span> i,j,k;
00197    <span class="keywordtype">int</span> it,jt,kt;
00198    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00199    <span class="keywordtype">double</span> a,<a class="code" href="jpegint_8h.html#a21">b</a>;
00200 
00201    volrec= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="group__Reconstruction.html#ga3">RecVolIFFTComplexeFromVol</a>(volrf);
00202    <a class="code" href="jerror_8h.html#a52a35">x</a> = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrec); y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrec); z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrec);
00203 
00204    phase = (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a6">VOL_FLOAT</a>);
00205 
00206    <span class="comment">/* Phase computation with dimx*dimy*dimz permutations */</span>
00207    <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00208    {
00209       it = (i + (<a class="code" href="jerror_8h.html#a52a35">x</a> / 2)) % <a class="code" href="jerror_8h.html#a52a35">x</a>;
00210       jt = (j + (y / 2)) % y;
00211       kt = (k + (z / 2)) % z;
00212       a = volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>;
00213       <a class="code" href="jpegint_8h.html#a21">b</a> = volrec[k][j][i].im;
00214       phase[kt][jt][it] = (<span class="keywordtype">float</span>) atan(<a class="code" href="jpegint_8h.html#a21">b</a>/a);
00215    }
00216    
00217    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrec);
00218    
00219    <span class="keywordflow">return</span>(phase);
00220 }
00221 
00222 
<a name="l00231"></a><a class="code" href="group__Reconstruction.html#ga4">00231</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTComplexe</a> (<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> *expr)
00232 {
00233    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> vol;
00234    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00235    <span class="keywordtype">int</span> i,j,k;
00236    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00237 
00238    vol= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr);
00239    vol= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="volfft_8c.html#a6">IdVolIFFT</a>((<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>) vol);
00240    
00241    <span class="comment">/* X permutation */</span>
00242    <a class="code" href="jerror_8h.html#a52a35">x</a>=<a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(vol);
00243    y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(vol);
00244    z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(vol);
00245    volrec = (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a10">VOL_COMPLEX_DOUBLE</a>);
00246    <span class="keywordflow">if</span>(!volrec)
00247     {
00248      printf(<span class="stringliteral">"Impossible d'allouer un volume dans RecVolIFFTComplexe !\n"</span>);
00249      exit(0);
00250      }
00251     <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00252     {
00253      volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>=vol[k][j][<a class="code" href="jerror_8h.html#a52a35">x</a>-1-i].<a class="code" href="structCOMPLEX.html#o0">re</a>;
00254      volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o1">im</a>=vol[k][j][<a class="code" href="jerror_8h.html#a52a35">x</a>-1-i].<a class="code" href="structCOMPLEX.html#o1">im</a>;
00255     }
00256     <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(vol);
00257    <span class="keywordflow">return</span>(volrec);
00258 }
00259 
00260 
<a name="l00269"></a><a class="code" href="group__Reconstruction.html#ga6">00269</a> <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> <a class="code" href="group__Reconstruction.html#ga6">RecVolIFFTModule</a> (<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> *expr)
00270 {
00271    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00272    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> module;
00273    <span class="keywordtype">int</span> i,j,k;
00274    <span class="keywordtype">int</span> it,jt,kt;
00275    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00276    <span class="keywordtype">double</span> a,<a class="code" href="jpegint_8h.html#a21">b</a>;
00277 
00278    volrec= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTComplexe</a>(expr);
00279    <a class="code" href="jerror_8h.html#a52a35">x</a> = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrec); y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrec); z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrec);
00280 
00281    module = (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a6">VOL_FLOAT</a>);
00282 
00283    <span class="comment">/* Module computation with dimx*dimy*dimz permutations */</span>
00284    <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00285    {
00286       it = (i + (<a class="code" href="jerror_8h.html#a52a35">x</a> / 2)) % <a class="code" href="jerror_8h.html#a52a35">x</a>;
00287       jt = (j + (y / 2)) % y;
00288       kt = (k + (z / 2)) % z;
00289       a = volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>;
00290       <a class="code" href="jpegint_8h.html#a21">b</a> = volrec[k][j][i].im;
00291       module[kt][jt][it] = (<span class="keywordtype">float</span>) sqrt((a*a) + (<a class="code" href="jpegint_8h.html#a21">b</a>*<a class="code" href="jpegint_8h.html#a21">b</a>));
00292    }
00293    
00294    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrec);
00295    
00296    <span class="keywordflow">return</span>(module);
00297 }
00298 
<a name="l00307"></a><a class="code" href="group__Reconstruction.html#ga7">00307</a> <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> <a class="code" href="group__Reconstruction.html#ga7">RecVolIFFTPhase</a> (<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a> *expr)
00308 {
00309    <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> volrec;
00310    <a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a> phase;
00311    <span class="keywordtype">int</span> i,j,k;
00312    <span class="keywordtype">int</span> it,jt,kt;
00313    <span class="keywordtype">int</span> <a class="code" href="jerror_8h.html#a52a35">x</a>,y,z;
00314    <span class="keywordtype">double</span> a,<a class="code" href="jpegint_8h.html#a21">b</a>;
00315 
00316    volrec= (<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>) <a class="code" href="group__Reconstruction.html#ga4">RecVolIFFTComplexe</a>(expr);
00317    <a class="code" href="jerror_8h.html#a52a35">x</a> = <a class="code" href="idvol-ido_8h.html#a21">IdVolDimX</a>(volrec); y=<a class="code" href="idvol-ido_8h.html#a22">IdVolDimY</a>(volrec); z=<a class="code" href="idvol-ido_8h.html#a23">IdVolDimZ</a>(volrec);
00318 
00319    phase = (<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>) <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>(<a class="code" href="jerror_8h.html#a52a35">x</a>,y,z,<a class="code" href="idvol-ido_8h.html#a6">VOL_FLOAT</a>);
00320 
00321    <span class="comment">/* Phase computation with dimx*dimy*dimz permutations */</span>
00322    <span class="keywordflow">for</span>(k=0;k&lt;z;k++) <span class="keywordflow">for</span>(j=0;j&lt;y;j++) <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="jerror_8h.html#a52a35">x</a>;i++)
00323    {
00324       it = (i + (<a class="code" href="jerror_8h.html#a52a35">x</a> / 2)) % <a class="code" href="jerror_8h.html#a52a35">x</a>;
00325       jt = (j + (y / 2)) % y;
00326       kt = (k + (z / 2)) % z;
00327       a = volrec[k][j][i].<a class="code" href="structCOMPLEX__DOUBLE.html#o0">re</a>;
00328       <a class="code" href="jpegint_8h.html#a21">b</a> = volrec[k][j][i].im;
00329       phase[kt][jt][it] = (<span class="keywordtype">float</span>) atan(<a class="code" href="jpegint_8h.html#a21">b</a>/a);
00330    }
00331    
00332    <a class="code" href="idvol_8h.html#a41">IdVolFree</a>(volrec);
00333    
00334    <span class="keywordflow">return</span>(phase);
00335 }
00336 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:14 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
