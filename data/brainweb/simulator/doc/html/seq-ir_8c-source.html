<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: seq-ir.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>seq-ir.c</h1><a href="seq-ir_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: seq-ir.c,v 1.4 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 2.0  20/12/2006</span>
00034 <span class="comment">*************************************************************************/</span>
00035 <span class="preprocessor">#include "<a class="code" href="seq-ir_8h.html">seq-ir.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="seq-mpi_8h.html">seq-mpi.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="event-acquisition_8h.html">event-acquisition.h</a>"</span>
00038 <span class="preprocessor">#include "<a class="code" href="experience_8h.html">experience.h</a>"</span>
00039 <span class="preprocessor">#include "<a class="code" href="event_8h.html">event.h</a>"</span>
00040 <span class="preprocessor">#include "<a class="code" href="event-rfpulse_8h.html">event-rfpulse.h</a>"</span>
00041 <span class="preprocessor">#include "<a class="code" href="event-precession_8h.html">event-precession.h</a>"</span>
00042 
00043 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga13">SeqInversionRecuperation1D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00044 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga14">SeqInversionRecuperation2D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00045 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga15">SeqInversionRecuperation3D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00046 
<a name="l00056"></a><a class="code" href="group__Sequence.html#ga9">00056</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga9">SeqInversionRecuperation1D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00057 {
00058    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam, expr, <a class="code" href="group__Sequence.html#ga13">SeqInversionRecuperation1D_0</a>);
00059    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00060    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00061 }
00062 
<a name="l00072"></a><a class="code" href="group__Sequence.html#ga10">00072</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga10">SeqInversionRecuperation2D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00073 {
00074    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam , expr, <a class="code" href="group__Sequence.html#ga14">SeqInversionRecuperation2D_0</a>);
00075    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00076    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00077 }
00078 
<a name="l00088"></a><a class="code" href="group__Sequence.html#ga11">00088</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga11">SeqInversionRecuperation3D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00089 {
00090    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam, expr, <a class="code" href="group__Sequence.html#ga15">SeqInversionRecuperation3D_0</a>);
00091    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00092    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00093 }
00094 
<a name="l00104"></a><a class="code" href="group__Sequence.html#ga0">00104</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga0">CheckTimesIR</a>(<span class="keywordtype">double</span> tacq,<span class="keywordtype">double</span> te,<span class="keywordtype">double</span> tr,<span class="keywordtype">double</span> ti)
00105 {
00106    <span class="keywordtype">int</span> f=0;
00107    <span class="keywordflow">if</span>((tacq&lt;te)&amp;&amp;(tr&gt;te+tacq/2.0))f=1;
00108    <span class="keywordflow">if</span>(f==0){
00109       <a class="code" href="simri3d_8h.html#a18">FPRINTF</a>(stderr,<span class="stringliteral">"Bad values for your sequence SE: Tacq=%g, Te=%g, Tr=%g\n"</span>,tacq, te, tr);
00110       exit(0);
00111    }
00112 }
00113 
<a name="l00122"></a><a class="code" href="group__Sequence.html#ga13">00122</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga13">SeqInversionRecuperation1D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00123 {
00124   <span class="keywordtype">int</span>      ntx;
00125   <span class="keywordtype">double</span>   fovx;
00126   <span class="keywordtype">double</span>   te,tr,tacq,ti; <span class="comment">/* in ms */</span>
00127   <span class="keywordtype">double</span>   gx,gy,gz;
00128   <span class="keywordtype">double</span>   acq_delay,timp; <span class="comment">/* in ms */</span>
00129   <span class="keywordtype">int</span>    npy, npz;
00130   <span class="keywordtype">int</span> i;
00131   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00132   event = &amp;event_r;
00133 
00134    printf(<span class="stringliteral">"Starting SeqInversionRecuperation1D\n"</span>);  
00135    ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00136    tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00137    fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00138    
00139    te = seqparam-&gt;te;
00140    tr = seqparam-&gt;tr;
00141    ti = seqparam-&gt;ti;
00142    
00143    <a class="code" href="group__Sequence.html#ga0">CheckTimesIR</a>(tacq,te,tr,ti);
00144 
00145    acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00146    timp=0.3; <span class="comment">/*RF pulse duration in ms */</span>
00147    
00148    gx=(ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;
00149    gy=0.0;
00150    gz=0.0;
00151    npy=0;npz=0;
00152 
00153    <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00154    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00155    <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00156 
00157    <span class="keywordflow">for</span>(i=0;i&lt;10;i++) <span class="comment">/* Repetition cycle to take TR into account */</span>
00158    {
00159    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00160    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,ti);
00161    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90., timp);
00162     <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, te/2.,gx,gy,gz);
00163     <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00164     <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, acq_delay+tacq,gx,gy,gz);
00165    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00166    }
00167    
00168    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00169    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,ti);
00170    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00171    <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, te/2.,gx,gy,gz);
00172    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00173    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00174 
00175    printf(<span class="stringliteral">"Ending SeqInversionRecuperation1D\n"</span>);  
00176 }
00177 
<a name="l00186"></a><a class="code" href="group__Sequence.html#ga14">00186</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga14">SeqInversionRecuperation2D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00187 {
00188   <span class="keywordtype">int</span>      ntx,nty;
00189   <span class="keywordtype">double</span>   fovx,fovy;
00190   <span class="keywordtype">double</span>   te,tr,ti,tacq,timp,acq_delay,tg; <span class="comment">/* ms */</span>
00191   <span class="keywordtype">double</span>   gx,gy,gz,gp;
00192   <span class="keywordtype">int</span>    npy, npz;
00193   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00194   event = &amp;event_r;
00195 
00196   printf(<span class="stringliteral">"Starting SeqInversionRecuperation2D \n"</span>);  
00197   ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00198   nty = expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>;
00199   tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00200   fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00201   fovy = expr-&gt;<a class="code" href="struct__Experience3D.html#o12">fovy</a>;
00202 
00203   ti = seqparam-&gt;ti;
00204   te = seqparam-&gt;te;
00205   tr = seqparam-&gt;tr;
00206 
00207   <a class="code" href="group__Sequence.html#ga0">CheckTimesIR</a>(tacq,te,tr,ti);
00208   timp=0.3; <span class="comment">/* Pulse duration in ms */</span>
00209   acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00210   tg = te/2.;
00211   gx = (ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;      
00212   gy = 2*M_PI*(nty-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovy/(tg/1000); 
00213   gz = 0.0;
00214   npz= 0;
00215 
00216   <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00217 
00218   <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00219   <span class="keywordflow">for</span> (npy = 0; npy &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>; npy++)
00220     {
00221        <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00222       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00223       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,ti);
00224 
00225       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00226       gp = (gy) * (npy - (nty) / 2) / (nty);
00227       <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event,tg,gx,gp,gz);
00228 
00229       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00230 
00231       <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00232 
00233       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00234     }
00235   printf(<span class="stringliteral">"Ending SeqInversionRecuperation2D\n"</span>);  
00236 }
00237 
00238 
<a name="l00247"></a><a class="code" href="group__Sequence.html#ga15">00247</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga15">SeqInversionRecuperation3D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00248 {
00249   <span class="keywordtype">int</span>      ntx,nty,ntz;
00250   <span class="keywordtype">double</span>   fovx,fovy,fovz;
00251   <span class="keywordtype">double</span>   te,tr,tacq,ti; <span class="comment">/* ms */</span>
00252   <span class="keywordtype">double</span>   gx,gy,gz;
00253   <span class="keywordtype">double</span>   acq_delay,timp; <span class="comment">/* ms */</span>
00254   <span class="keywordtype">int</span>    npy,npz;
00255   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00256   event = &amp;event_r;
00257   
00258   printf(<span class="stringliteral">"Starting SeqInversionRecuperation3D\n"</span>);  
00259    ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00260    nty = expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>;
00261    ntz = expr-&gt;<a class="code" href="struct__Experience3D.html#o3">ntz</a>;
00262    tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00263    fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00264    fovy = expr-&gt;<a class="code" href="struct__Experience3D.html#o12">fovy</a>;
00265    fovz = expr-&gt;<a class="code" href="struct__Experience3D.html#o13">fovz</a>;
00266 
00267    te = seqparam-&gt;te;
00268    tr = seqparam-&gt;tr;
00269    ti = seqparam-&gt;ti;
00270    
00271    <a class="code" href="group__Sequence.html#ga0">CheckTimesIR</a>(tacq,te,tr,ti);
00272 
00273    acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00274    
00275    gx=(ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;       
00276    gy=2*M_PI*(nty-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovy/(te/2./1000); 
00277    gz=2*M_PI*(ntz-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovz/(te/2./1000); 
00278    timp=0.3; <span class="comment">/* Pulse duration in ms */</span>
00279 
00280    <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00281 
00282    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00283    <span class="keywordflow">for</span> (npy = 0; npy &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>; npy++) {
00284    <span class="keywordflow">for</span> (npz = 0; npz &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o3">ntz</a>; npz++) {
00285         <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00286       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 180.,timp);
00287       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,ti);
00288       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90., timp);
00289       <a class="code" href="group__Event.html#ga0">DoGradient</a>( expr,event, te/2.,gx,
00290             (gy) * (npy - nty / 2) / nty,
00291                 (gz) * (npz - ntz / 2) / ntz);
00292       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00293       <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00294       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00295    }}
00296    printf(<span class="stringliteral">"Ending SeqInversionRecuperation3D\n"</span>);  
00297 
00298 }
00299 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:14 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
