<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: acrread.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>acrread.c</h1><a href="acrread_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: acrread.c,v 1.1 2005/09/09 08:22:21 bellet Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 1.0  05/09/2005</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="comment">/*************************************************************************</span>
00037 <span class="comment">*                                  * PROJET      : libido</span>
00038 <span class="comment">* NOM DU MODULE : readacr.c        * TYPE        : fonction</span>
00039 <span class="comment">* AUTEUR        : c.odet           * CREATION    :  07/05/1992</span>
00040 <span class="comment">* VERSION       :                  * REVISION    :  </span>
00041 <span class="comment">* LANGAGE       : C                * </span>
00042 <span class="comment">*                                  *</span>
00043 <span class="comment">******************************************** ******************************</span>
00044 <span class="comment">*</span>
00045 <span class="comment">*  Description : Lit un objet LIBIDO dans un fichier </span>
00046 <span class="comment">*     au format ACRNEMA modifie URA1216</span>
00047 <span class="comment">**************************************************************************</span>
00048 <span class="comment">*</span>
00049 <span class="comment">*  MODULES UTILISES :</span>
00050 <span class="comment">*</span>
00051 <span class="comment">**************************************************************************</span>
00052 <span class="comment">*                     |              |</span>
00053 <span class="comment">* REVISIONS :  DATE   | AUTEUR       |  DESCRIPTION</span>
00054 <span class="comment">*---------------------|--------------|------------------------------------</span>
00055 <span class="comment">*           16/06/92  | B. BARBIER   | Insertion Libido</span>
00056 <span class="comment">*           15/9/92   |   ""         | V1.2-5 normalisation des noms</span>
00057 <span class="comment">*           01/10/92  | B. Barbier   | V1.2-5 : normalisation des noms</span>
00058 <span class="comment">*           08/10/92  | CO           | V1.3 changement de structure</span>
00059 <span class="comment">*            10/11/94   JPR            prise en compte des Signaux</span>
00060 <span class="comment">*            25/01/95   JPR            prise en compte types non UCHAR</span>
00061 <span class="comment">*            21/04/95   CO             complexes  Ima </span>
00062 <span class="comment">             22 04 95   JPR            prise en compte types non Reel  </span>
00063 <span class="comment">             29 04 95   JPR            IdAcrInquireInfo  </span>
00064 <span class="comment">        16 06 95   JPR            IdAcrInquirePixelSize </span>
00065 <span class="comment">              3 07 95   JPR            remplacement elem non-ACR 28,105</span>
00066 <span class="comment">               par 28,199 pour compatibilite images</span>
00067 <span class="comment">               Phillips  </span>
00068 <span class="comment">        25/10/95  JPR      _IdAcrCheckType pour rationnaliser </span>
00069 <span class="comment">               l'usine a gaz... </span>
00070 <span class="comment">        8/01/96   JPR      Lecture des Objets CONTOUR</span>
00071 <span class="comment">        5/02/96   JPR      UsedNbX ...  </span>
00072 <span class="comment">        6/02/96   JPR      IdAcrInquireType (pour test swap)</span>
00073 <span class="comment">      6/5/96   CO    Initialisation NX,NY,NZ dans IdAcrInquireInfo</span>
00074 <span class="comment">        04/09/96   JPR+ GB         VRAIE prise en compte de nbu et hightBit</span>
00075 <span class="comment">         3/2/97   JPR      Prise en compte champ _message  </span>
00076 <span class="comment">         7/2/97   JPR      PROBLEME pour les elements 'chaine de caract' :</span>
00077 <span class="comment">               Ils doivent etre alloues </span>
00078 <span class="comment">               AVANT l'appel de IdAcrReadElement </span>
00079 <span class="comment">   19/2/97     BB    Read dans GetSliceThickness</span>
00080 <span class="comment">   20/2/97     JPR      Verif entete </span>
00081 <span class="comment">   17/4/97     JPR      Ajout SEQUENCE         </span>
00082 <span class="comment">        9/10/97      JPR      IdAcrInquireInfoTot : correction pb sur NT des SEQ</span>
00083 <span class="comment">   20/4/98     JPR      Modif IdIrmGetAndRenameDirContents</span>
00084 <span class="comment">               pour pb inscription Xtiple si renomage...</span>
00085 <span class="comment">   21/4/98     JPR      Correction confusion CNT et SIG en lecture ACR</span>
00086 <span class="comment"></span>
00087 <span class="comment">   19/5/98     JPR      IdDcmCVReadFile pour DICOM CardioVasc</span>
00088 <span class="comment">   20/5/98     JPR      Elagage IdAcrReadFile</span>
00089 <span class="comment">   27/5/98     JPR      IdAcrInquireInfoTot2, pour DICOM CardioVasc</span>
00090 <span class="comment">   15/12/98 JPR      Erreur ds dimX dimY pour les VRAIES images ACR</span>
00091 <span class="comment">               (rectangulaires)</span>
00092 <span class="comment">   19/2/99     Djamal Boukerroui IdAcrReadFile : correction code retour si </span>
00093 <span class="comment">                     erreur dans IdDcmCVReadFile</span>
00094 <span class="comment">         </span>
00095 <span class="comment">   19/3/99     JPR      Alloc dynamique pour les _message monstrueux</span>
00096 <span class="comment">   29/6/99     JPR      Correction Swap pour CardioVasc sur Dec</span>
00097 <span class="comment">   30/6/99     JPR      Modif _IdAcrGetPixelOffset pour SGI</span>
00098 <span class="comment">   1/07/99     JPR      Prise en compte RGB DICOM</span>
00099 <span class="comment">   24/08/99 JPR      Ajout IdAcrInquireInfoTot3 (renvoie le codeSwap)</span>
00100 <span class="comment">   15/10/99 Djamal Boukerroui Pb indicateur de fin du champ _message, a la relecture</span>
00101 <span class="comment">   21/10/99 JPR      Pb lgr message si fichier non LibIDO</span>
00102 <span class="comment">   24-01-2000  FB    initialisations</span>
00103 <span class="comment">   09-08-2000  JPR      Modif lecture lgr pour Philips single Frame (PAPYRUS-like)</span>
00104 <span class="comment">   31-08-2000  JPR      Prise en compte Nb Bits stored = 12 dans _IdAcrCheckType</span>
00105 <span class="comment">   23-06-2001  JPR      j'enleve la  prise en compte ERRONNEE de nbu et hightBit</span>
00106 <span class="comment"></span>
00107 <span class="comment"></span>
00108 <span class="comment">POURRIEZ-VOUS EVITER DE VIRER CES COMMENTAIRES.</span>
00109 <span class="comment">MERCI</span>
00110 <span class="comment"></span>
00111 <span class="comment">JPRx</span>
00112 <span class="comment"></span>
00113 <span class="comment">**************************************************************************/</span>
00114 
00115 
00116 <span class="preprocessor">#include &lt;string.h&gt;</span>  <span class="comment">// For strlen</span>
00117 <span class="preprocessor">#include "<a class="code" href="idio_8h.html">idio.h</a>"</span>
00118 <span class="preprocessor">#include "<a class="code" href="idprint_8h.html">idprint.h</a>"</span>
00119 <span class="preprocessor">#include "<a class="code" href="idacr-private_8h.html">idacr-private.h</a>"</span>
00120 <span class="preprocessor">#include "<a class="code" href="iddcm_8h.html">iddcm.h</a>"</span>
00121 
00122 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="acrwrite_8c.html#a0">DEBUG</a>=0;
00123 
00124 <span class="comment">/* </span>
00125 <span class="comment">Rappels</span>
00126 <span class="comment">-------</span>
00127 <span class="comment">     </span>
00128 <span class="comment">#define TY_CHAR           ( 0&lt;&lt;4)  00</span>
00129 <span class="comment">#define TY_FLOAT       ( 1&lt;&lt;4)  10</span>
00130 <span class="comment">#define TY_DOUBLE      ( 2&lt;&lt;4)  20</span>
00131 <span class="comment">#define TY_COMPLEX        ( 3&lt;&lt;4)  30</span>
00132 <span class="comment">#define TY_RGB         ( 4&lt;&lt;4)  40</span>
00133 <span class="comment">#define TY_SHORT       ( 5&lt;&lt;4)  50</span>
00134 <span class="comment">#define TY_LONG           ( 6&lt;&lt;4)  60</span>
00135 <span class="comment">#define TY_UCHAR       ( 7&lt;&lt;4)  70</span>
00136 <span class="comment">#define TY_USHORT         ( 8&lt;&lt;4)  80                             </span>
00137 <span class="comment">#define TY_COMPLEX_DOUBLE ( 9&lt;&lt;4)  90                              </span>
00138 <span class="comment">#define TY_COMPLEX_FLOAT  (10&lt;&lt;4)  a0                             </span>
00139 <span class="comment">#define TY_COMPLEX_CHAR   (11&lt;&lt;4)  b0                             </span>
00140 <span class="comment">#define TY_COMPLEX_UCHAR  (12&lt;&lt;4)  c0                            </span>
00141 <span class="comment">#define TY_COMPLEX_SHORT  (13&lt;&lt;4)  d0                             </span>
00142 <span class="comment">#define TY_COMPLEX_USHORT (14&lt;&lt;4)  e0                            </span>
00143 <span class="comment">#define TY_COMPLEX_LONG   (15&lt;&lt;4)  f0                            </span>
00144 <span class="comment">#define TY_BIT            (16&lt;&lt;4) 100                             </span>
00145 <span class="comment">#define TY_IDPOINT        (17&lt;&lt;4) 110</span>
00146 <span class="comment">#define TY_FACE           (18&lt;&lt;4) 120</span>
00147 <span class="comment">#define TY_POINTER        (19&lt;&lt;4) 130            </span>
00148 <span class="comment">#qdefine TY_ULONG         (20&lt;&lt;4) 140            </span>
00149 <span class="comment">#define TY_COMPLEX_ULONG  (21&lt;&lt;4) 150</span>
00150 <span class="comment"></span>
00151 <span class="comment">#define TY_IDXPOINT_CHAR  (22&lt;&lt;4) 160        </span>
00152 <span class="comment">#define TY_IDXPOINT_UCHAR (23&lt;&lt;4) 170</span>
00153 <span class="comment">#define TY_IDXPOINT_FLOAT (24&lt;&lt;4) 180</span>
00154 <span class="comment">#define TY_IDXPOINT_DOUBLE(25&lt;&lt;4) 190</span>
00155 <span class="comment">#define TY_IDXPOINT_SHORT (26&lt;&lt;4) 1a0</span>
00156 <span class="comment">#define TY_IDXPOINT_USHORT(27&lt;&lt;4) 1b0</span>
00157 <span class="comment">#define TY_IDXPOINT_LONG  (28&lt;&lt;4) 1c0</span>
00158 <span class="comment">#define TY_IDXPOINT_ULONG (29&lt;&lt;4) 1d0        </span>
00159 <span class="comment"></span>
00160 <span class="comment">#define TY_COLOR          (30&lt;&lt;4) 1fo</span>
00161 <span class="comment">*/</span>           
00162 
00163 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00164 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>  <span class="comment">// For atoi</span>
00165 <span class="preprocessor">#include "<a class="code" href="idgen_8h.html">idgen.h</a>"</span>
00166 <span class="preprocessor">#include "<a class="code" href="idsig_8h.html">idsig.h</a>"</span>
00167 <span class="preprocessor">#include "<a class="code" href="idcnt_8h.html">idcnt.h</a>"</span>
00168 <span class="preprocessor">#include "<a class="code" href="idima_8h.html">idima.h</a>"</span>
00169 <span class="preprocessor">#include "<a class="code" href="idvol_8h.html">idvol.h</a>"</span>
00170 <span class="preprocessor">#include "<a class="code" href="idseq_8h.html">idseq.h</a>"</span>
00171 <span class="preprocessor">#include "<a class="code" href="idacr_8h.html">idacr.h</a>"</span>
00172 <span class="preprocessor">#include "<a class="code" href="idacr-restricted_8h.html">idacr-restricted.h</a>"</span>
00173 <span class="preprocessor">#include "<a class="code" href="iderr_8h.html">iderr.h</a>"</span>
00174 
00175 
00176 <span class="keywordtype">int</span> <a class="code" href="acrutil_8c.html#a14">_IdAcrRecupLgr</a>    (FILE *fp, <span class="keywordtype">int</span> *);
00177 <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a18">_IdAcrIsAcrLibido</a> (FILE *fp,<span class="keywordtype">char</span> *bufbid);
00178 
00179  
00180 <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="acrutil_8c.html#a17">SWAP_SHORT</a>       (<span class="keywordtype">short</span> <span class="keywordtype">int</span>);
00181 <span class="keywordtype">long</span> <span class="keywordtype">int</span>  <a class="code" href="acrutil_8c.html#a18">SWAP_LONG</a>        (<span class="keywordtype">long</span> <span class="keywordtype">int</span>);
00182 
00183 <span class="keyword">static</span> <span class="keywordtype">int</span> ACR_LIBIDO;
00184 
00185 <span class="keyword">static</span> <span class="keywordtype">int</span> rgb;
00186 
00187 <span class="keyword">static</span> <span class="keywordtype">int</span> sw;
00188 <span class="keyword">static</span> <span class="keywordtype">char</span>  * _message;
00189 
<a name="l00190"></a><a class="code" href="acrread_8c.html#a11">00190</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a>;
<a name="l00191"></a><a class="code" href="acrread_8c.html#a12">00191</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a12">__ID_offset</a>;
<a name="l00192"></a><a class="code" href="acrread_8c.html#a13">00192</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a13">__Papyrus</a>;
<a name="l00193"></a><a class="code" href="acrread_8c.html#a14">00193</a> <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a14">__NumeroGroupePrecedent</a>;
<a name="l00194"></a><a class="code" href="acrread_8c.html#a15">00194</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a15">__TrueDicom</a>;
<a name="l00195"></a><a class="code" href="acrread_8c.html#a16">00195</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a16">__ExplicitVR</a>;   
00196 
00197 
00198 <span class="comment">/* FUNCTION DESCRIPTION **************************************************</span>
00199 <span class="comment">* </span>
00200 <span class="comment">* IdDcmCVReadFile  (fonction)</span>
00201 <span class="comment">* </span>
00202 <span class="comment">* RESUME: Lecture d'un fichier de type DICOM MultiFrame.</span>
00203 <span class="comment">* </span>
00204 <span class="comment">* DESCRIPTION: Lecture d'un fichier de type DICOM MultiFrame.</span>
00205 <span class="comment">* </span>
00206 <span class="comment">*     A L'ATTENTION DES Kamikazes Creatissiens :</span>
00207 <span class="comment">*     La fonction IdAcrReadFile (supposee lire des fichiers 'ACR LibIDO')</span>
00208 <span class="comment">*     a evolue au fil des ans, en fonction des choses </span>
00209 <span class="comment">*     que l'on a considere comme utiles de rajouter dans NOTRE entete.</span>
00210 <span class="comment">*     Puis, on a eu de 'vrais' fichiers ACR-NEMA, V2 puis V3.</span>
00211 <span class="comment">*     Puis des fichiers DICOM single-frame.</span>
00212 <span class="comment">*     Puis des fichiers DICOM multiframe.</span>
00213 <span class="comment">*     A ajouter a ca, des particularites a la limite de la mauvaise foi,</span>
00214 <span class="comment">*     dependant des constructeurs...</span>
00215 <span class="comment">* </span>
00216 <span class="comment">*     DONC :</span>
00217 <span class="comment">* </span>
00218 <span class="comment">*     Ne perdez pas votre temps a essayer de comprendre POURQUOI ...</span>
00219 <span class="comment">*     La reponse est : PARCE QUE !</span>
00220 <span class="comment">* </span>
00221 <span class="comment">* </span>
00222 <span class="comment">* SYNTAXE:     PPIMAGE tabIm[] = IdDcmCVReadFile (char * filename, int numPremiereImage, int numDerniereImage);</span>
00223 <span class="comment">* </span>
00224 <span class="comment">* RETOUR:      type  : void **</span>
00225 <span class="comment">*       role  : Pointeur vers un tableau d'objets</span>
00226 <span class="comment">* </span>
00227 <span class="comment">* PARAMETRES:</span>
00228 <span class="comment">*       nom   : filename</span>
00229 <span class="comment">*       type  : char *</span>
00230 <span class="comment">*       role  : Nom du fichier DICOM MultiFrame</span>
00231 <span class="comment">* </span>
00232 <span class="comment">*       nom   : typeObj</span>
00233 <span class="comment">*       type  : int</span>
00234 <span class="comment">*       role  : Type de l'object a lire (IMA_UCHAR, SIG_CHAR, ...).</span>
00235 <span class="comment">* </span>
00236 <span class="comment">*       nom   : numPremiereImage</span>
00237 <span class="comment">*       type  : int</span>
00238 <span class="comment">*       role  : Num premiere image a lire (si -1 -ou 0- on commence a la premiere).</span>
00239 <span class="comment">* </span>
00240 <span class="comment">*       nom   : numDerniereImage</span>
00241 <span class="comment">*       type  : int</span>
00242 <span class="comment">*       role  : Num derniere image a lire (si -1 -ou 0- on fini a la derniere).</span>
00243 <span class="comment">* </span>
00244 <span class="comment">* FICHIER:     readacr.c</span>
00245 <span class="comment">* </span>
00246 <span class="comment">******************************************************** END DESCRIPTION */</span>
00247 
00248 <span class="comment">/* JPR, pour eviter de dupliquer le source    */</span>
00249 
<a name="l00250"></a><a class="code" href="acrread_8c.html#a0">00250</a> <span class="preprocessor">#define CCS(Type)                   \</span>
00251 <span class="preprocessor">if(!fread(&amp;((Type)psi)[0],IdSigDimX(psi)*IdSizeOfType(psi),1,fp)) \</span>
00252 <span class="preprocessor">                           \</span>
00253 <span class="preprocessor">         {                       \</span>
00254 <span class="preprocessor">            IdSigFree(psi);               \</span>
00255 <span class="preprocessor">            IdErrPrintf("echec en lecture Signal\n");\</span>
00256 <span class="preprocessor">       return(0);                \</span>
00257 <span class="preprocessor">    }</span>
00258 <span class="preprocessor"></span>
<a name="l00259"></a><a class="code" href="acrread_8c.html#a1">00259</a> <span class="preprocessor">#define CCC(Type)                   \</span>
00260 <span class="preprocessor">if(!fread(&amp;((Type)pco)[0],IdCntDimX(pco)*IdSizeOfType(pco),1,fp)) \</span>
00261 <span class="preprocessor">                           \</span>
00262 <span class="preprocessor">         {                       \</span>
00263 <span class="preprocessor">            IdCntFree(pco);               \</span>
00264 <span class="preprocessor">            IdErrPrintf("echec en lecture Contour\n");   \</span>
00265 <span class="preprocessor">       return(0);                \</span>
00266 <span class="preprocessor">    }</span>
00267 <span class="preprocessor"></span>
00268 <span class="comment">/* pour les anciens codage de contour */</span>
<a name="l00269"></a><a class="code" href="acrread_8c.html#a2">00269</a> <span class="preprocessor">#define CCC2(Type)                     \</span>
00270 <span class="preprocessor">if(!fread(&amp;((Type)pco)[0],IdCntDimX(pco)*IdSizeOfType(pco)&gt;&gt;1,1,fp))\</span>
00271 <span class="preprocessor">                           \</span>
00272 <span class="preprocessor">         {                       \</span>
00273 <span class="preprocessor">            IdCntFree(pco);               \</span>
00274 <span class="preprocessor">            IdErrPrintf("echec en lecture Contour\n");   \</span>
00275 <span class="preprocessor">       return(0);                \</span>
00276 <span class="preprocessor">    }</span>
00277 <span class="preprocessor"></span>
<a name="l00278"></a><a class="code" href="acrread_8c.html#a3">00278</a> <span class="preprocessor">#define CCI(Type,TailleType)                                      \</span>
00279 <span class="preprocessor">   {                                                     \</span>
00280 <span class="preprocessor">   if (vector != NULL) { </span><span class="comment">/* on a une contrainte de rapidite */</span>          \
00281       if(!fread(vector,(int)dim[0]*(int)dim[1]*TailleType,1,fp)){    \
00282             IdPrintf("echec en lecture Image dans Vecteur \n");      \
00283                return(0);                                   \
00284       }                                               \
00285    } else {                                              \
00286       for(i=0;i&lt;IdImaDimY(pim);i++){                           \
00287                if(!fread(((Type)pim)[i],IdImaDimX(pim)*IdSizeOfType(pim),1,fp)) { \
00288                      IdPrintf("echec en lecture Image [i : %d] lgr de %d \n", \
00289                   i,IdImaDimX(pim)*IdSizeOfType(pim));         \
00290                      IdImaFree(pim);                                 \
00291                return(0);                                   \
00292          }                       \
00293       }                          \
00294    }                             \
00295    }                                                     \
00296                                        
<a name="l00297"></a><a class="code" href="acrread_8c.html#a4">00297</a> <span class="preprocessor">#define CCV(Type)                            \</span>
00298 <span class="preprocessor">   for(j=0;j&lt;IdVolDimZ(pvo);j++)             \</span>
00299 <span class="preprocessor">     for(i=0;i&lt;IdVolDimY(pvo);i++)              \</span>
00300 <span class="preprocessor">      if(!fread(((Type)pvo)[j][i],IdVolDimX(pvo)*IdSizeOfType(pvo),1,fp)) \</span>
00301 <span class="preprocessor">        {                                 \</span>
00302 <span class="preprocessor">         IdVolFree(pvo);                     \</span>
00303 <span class="preprocessor">              IdErrPrintf("echec en lecture Volume\n");  \</span>
00304 <span class="preprocessor">         return(0);                       \</span>
00305 <span class="preprocessor">        }</span>
00306 <span class="preprocessor"></span>
<a name="l00307"></a><a class="code" href="acrread_8c.html#a5">00307</a> <span class="preprocessor">#define CCQ(Type)                            \</span>
00308 <span class="preprocessor">   for(k=0;k&lt;IdSeqDimT(pse);k++)             \</span>
00309 <span class="preprocessor">   for(j=0;j&lt;IdSeqDimZ(pse);j++)             \</span>
00310 <span class="preprocessor">     for(i=0;i&lt;IdSeqDimY(pse);i++)              \</span>
00311 <span class="preprocessor">      if(!fread(((Type)pse)[k][j][i],IdSeqDimX(pse)*IdSizeOfType(pse),1,fp))  \</span>
00312 <span class="preprocessor">        {                                 \</span>
00313 <span class="preprocessor">         IdSeqFree(pse);                     \</span>
00314 <span class="preprocessor">              IdErrPrintf("echec en lecture Sequence\n");\</span>
00315 <span class="preprocessor">         return(0);                       \</span>
00316 <span class="preprocessor">        }</span>
00317 <span class="preprocessor"></span>
00318 <span class="comment">//-------------------------------------------------------------------------</span>
00319 <span class="comment">//</span>
00320 <span class="comment">// IdAcrReadFileIntoVector est un sur-ensemble de IdAcrReadFile</span>
00321 <span class="comment">//</span>
00322 
<a name="l00360"></a><a class="code" href="idacr_8h.html#a74">00360</a> <span class="keywordtype">void</span> *<a class="code" href="idacr_8h.html#a74">IdAcrReadFileIntoVector</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> premIm, <span class="keywordtype">int</span> dernIm, <span class="keywordtype">void</span> * vector) {
00361    
00362     <span class="keywordflow">return</span> <a class="code" href="iddcm_8h.html#a14">IdDcmReadFileIntoVector</a>(filename,  type,  premIm,  dernIm, vector) ;
00363     <span class="keywordflow">return</span> (NULL);
00364 }
00365 
00366 
00367 
00368 <span class="comment">/* FUNCTION DESCRIPTION **************************************************</span>
00369 <span class="comment">* </span>
00370 <span class="comment">* IdAcrInquireInfoTot4  (fonction)</span>
00371 <span class="comment">* </span>
00372 <span class="comment">* RESUME: Retourne diverses info stockees dans l'entete ACRNEMA.</span>
00373 <span class="comment">* </span>
00374 <span class="comment">* DESCRIPTION: Retourne des info sur l'objet stocke dans un fichier ACRNEMA.</span>
00375 <span class="comment">*  Remplace IdAcrInquireInfo, qui etait incomplet</span>
00376 <span class="comment">* </span>
00377 <span class="comment">* SYNTAXE:     int retCode = IdAcrInquireInfoTot4 (char *filename, int *typObj, *typLibido, int *typData, int *NX, int *NY, int *NZ, int *NT, int *tailleEntete, int *nbFrames, int* nb, int *nbu, int *hb, int *sign);</span>
00378 <span class="comment">* </span>
00379 <span class="comment">* RETOUR:      type  : int</span>
00380 <span class="comment">*       role  : 0: echec 1: succes.</span>
00381 <span class="comment">* </span>
00382 <span class="comment">* PARAMETRES:</span>
00383 <span class="comment">*       nom   : filename</span>
00384 <span class="comment">*       type  : char *</span>
00385 <span class="comment">*       role  : Nom du fichier ACRNEMA</span>
00386 <span class="comment">* </span>
00387 <span class="comment">*       nom   : typeObj</span>
00388 <span class="comment">*       type  : int *</span>
00389 <span class="comment">*       role  : type d'objet (SIG, IMA, VOL, CNT, ...</span>
00390 <span class="comment">* </span>
00391 <span class="comment">*       nom   : typLibido</span>
00392 <span class="comment">*       type  : int *</span>
00393 <span class="comment">*       role  : type d'objet (TY_DOUBLE, TY_UCHAR, TY_COMPLEX_DOUBLE ...</span>
00394 <span class="comment">* </span>
00395 <span class="comment">*        Si l'on veut fabriquer, a partir de ce type LibIDO un objet d'un autre type d'objet</span>
00396 <span class="comment">*        (p ex, on a lu un VOLUME, on veut fabriquer une IMAGE de meme type)</span>
00397 <span class="comment">*        On fera :</span>
00398 <span class="comment">*        typeIma=typeLibido | IMA;</span>
00399 <span class="comment">* </span>
00400 <span class="comment">*       nom   : typData</span>
00401 <span class="comment">*       type  : int *</span>
00402 <span class="comment">*       role  : type de Donnees LibIDO de l'objet (SIG_DOUBLE, IMA_UCHAR, VOL_COMPLEX_DOUBLE, ...           </span>
00403 <span class="comment">*       nom   : NX</span>
00404 <span class="comment">*       type  : int *</span>
00405 <span class="comment">*       role  : taille en X de l'objet (SIG, IMA, VOL, SEQ seulement)</span>
00406 <span class="comment">* </span>
00407 <span class="comment">*       nom   : NY</span>
00408 <span class="comment">*       type  : int *</span>
00409 <span class="comment">*       role  : taille en Y de l'objet (IMA, VOL, SEQ seulement)</span>
00410 <span class="comment">* </span>
00411 <span class="comment">*       nom   : NZ</span>
00412 <span class="comment">*       type  : int *</span>
00413 <span class="comment">*       role  : taille en Z de l'objet (VOL, SEQ seulement)</span>
00414 <span class="comment">* </span>
00415 <span class="comment">*       nom   : NT</span>
00416 <span class="comment">*       type  : int *</span>
00417 <span class="comment">*       role  : taille en T de l'objet (SEQ seulement)</span>
00418 <span class="comment">* </span>
00419 <span class="comment">*       nom   : tailleEntete</span>
00420 <span class="comment">*       type  : int *</span>
00421 <span class="comment">*       role  : taille, en octets, de l'entete a sauter</span>
00422 <span class="comment">* </span>
00423 <span class="comment">*       nom   : nbFrames</span>
00424 <span class="comment">*       type  : int *</span>
00425 <span class="comment">*       role  : nb d'images, ds le cas DICOM CardioVasc</span>
00426 <span class="comment">*</span>
00427 <span class="comment">*       nom   : codeSwap</span>
00428 <span class="comment">*       type  : int *</span>
00429 <span class="comment">*       role  : code de swap des octets</span>
00430 <span class="comment">* </span>
00431 <span class="comment">*       nom   : nb</span>
00432 <span class="comment">*       type  : int *</span>
00433 <span class="comment">*       role  : nombre de bits alloues</span>
00434 <span class="comment">*</span>
00435 <span class="comment">*       nom   : nbu</span>
00436 <span class="comment">*       type  : int *</span>
00437 <span class="comment">*       role  : nombre de bits utiles</span>
00438 <span class="comment">*</span>
00439 <span class="comment">*       nom   : hb</span>
00440 <span class="comment">*       type  : int *</span>
00441 <span class="comment">*       role  : Bit de poids fort</span>
00442 <span class="comment">*</span>
00443 <span class="comment">*       nom   : sign</span>
00444 <span class="comment">*       type  : int *</span>
00445 <span class="comment">*       role  : signe des pixels</span>
00446 <span class="comment">*</span>
00447 <span class="comment">*</span>
00448 <span class="comment">* </span>
00449 <span class="comment">* FICHIER:     readacr.c</span>
00450 <span class="comment">* </span>
00451 <span class="comment">******************************************************** END DESCRIPTION */</span>
00452 
00453 
<a name="l00486"></a><a class="code" href="idacr_8h.html#a102">00486</a> <span class="keywordtype">int</span> <a class="code" href="idacr_8h.html#a102">IdAcrInquireInfoTot4</a> ( <span class="keywordtype">char</span> * filename,
00487          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj,
00488          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido,
00489          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData,
00490          <span class="keywordtype">int</span> *NX, 
00491          <span class="keywordtype">int</span> *NY, 
00492          <span class="keywordtype">int</span> *NZ, 
00493          <span class="keywordtype">int</span> *NT,
00494          <span class="keywordtype">int</span> *offset,
00495          <span class="keywordtype">int</span> *nbFrames,
00496          <span class="keywordtype">int</span> *codeSwap, 
00497          <span class="keywordtype">int</span> *bitsAllocated,
00498          <span class="keywordtype">int</span> *bitsStored,
00499          <span class="keywordtype">int</span> *highBit,
00500          <span class="keywordtype">int</span> *signe)
00501 {
00502   FILE *fp;
00503   <span class="keywordtype">short</span> <span class="keywordtype">int</span> ndim,nb,nbu,hb,ty;
00504   <span class="keywordtype">short</span> <span class="keywordtype">int</span> dim[4];
00505   <span class="keywordtype">int</span> i  <span class="comment">/* ,sw */</span> ;     <span class="comment">/* sw en Global */</span>
00506   <span class="keywordtype">char</span> bufbid[150];
00507   <span class="keywordtype">long</span> <span class="keywordtype">int</span> nbCarLus;
00508 
00509 <span class="keywordflow">if</span>((fp=fopen(filename,<a class="code" href="idio_8h.html#a0">ID_RFILE_BIN</a>))==0) {
00510    <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a22">IDERR_OPEN_FAILED</a>;
00511    <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a> (<span class="stringliteral">"echec ouverture  %s\n"</span>,filename);
00512    <span class="keywordflow">return</span> (0);
00513  } <span class="keywordflow">else</span>
00514       sw=<a class="code" href="idacr-restricted_8h.html#a8">_IdAcrCheckSwap</a>(fp);
00515 
00516  <span class="keywordflow">if</span>(sw==-1) { 
00517    <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00518       fclose ( fp );
00519    <span class="keywordflow">return</span> (0);
00520  }
00521 
00522  *codeSwap=sw;
00523 
00524 <span class="keywordflow">if</span> ( <a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a> == 1) {
00525    printf(<span class="stringliteral">"ID_CardioVascCurieux : 2\n"</span>);
00526    fseek(fp,0L,<a class="code" href="volrdf_8c.html#a0">SEEK_SET</a>); <span class="comment">/* pas trouve 08,00; on se met au debut */</span>
00527 } <span class="keywordflow">else</span> {
00528    ACR_LIBIDO = <a class="code" href="acrread_8c.html#a18">_IdAcrIsAcrLibido</a> (fp,bufbid);  
00529 }
00530 
00531    *typData=0;
00532    nbCarLus=<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0004,fp,bufbid);
00533 
00534    <span class="keywordflow">if</span>(nbCarLus!=0) { <span class="comment">/* RGB  */</span>
00535 
00536         bufbid[nbCarLus]=0;
00537 
00538         <span class="keywordflow">if</span> (  (memcmp(bufbid,<span class="stringliteral">"RGB "</span>,4)==0)    
00539             ||
00540                     (memcmp(bufbid,<span class="stringliteral">"B RG"</span>,4)==0) 
00541             ||
00542                     (memcmp(bufbid,<span class="stringliteral">" BGR"</span>,4)==0)          
00543             ||
00544                     (memcmp(bufbid,<span class="stringliteral">"GR B"</span>,4)==0) )  {
00545 
00546          *typData=<a class="code" href="idgen_8h.html#a23">TY_RGB</a>;
00547          <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">"Image RGB !\n"</span>);
00548       }
00549 
00550     }
00551                                   <span class="comment">/* JPR  27-05-98*/</span>
00552 
00553       <span class="comment">/* Lecture dimension de l'espace */</span>
00554   <span class="keywordflow">if</span> (!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0005,fp,&amp;ndim)) {
00555    ndim=2; 
00556   }
00557                                   <span class="comment">/* JPR */</span>
00558   <span class="keywordflow">if</span>(ndim&gt;4) {
00559    <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" Nb de Dimensions incorrect : %d\n"</span>, ndim);
00560         fclose ( fp );
00561    <span class="keywordflow">return</span>(0);
00562   }
00563 
00564       <span class="comment">/* Lecture nbFrames pour CardioVasc */</span>
00565 
00566   <span class="keywordflow">if</span> ((nbCarLus=<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0008,fp,bufbid))==0) {
00567    *nbFrames=1;
00568   } <span class="keywordflow">else</span>
00569    *nbFrames=atoi(bufbid); <span class="comment">/*  c'est des caracteres type : IS, pas un short int  */</span>
00570 
00571   <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
00572       <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0010+i,fp,&amp;dim[i])) {
00573 
00574      <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00575           fclose ( fp );
00576      <span class="keywordflow">return</span> (0);
00577       }
00578 
00579   <span class="keywordflow">if</span> (ACR_LIBIDO!=1) { <span class="comment">/* si c'est une VRAIE image ACR     */</span>
00580              <span class="comment">/* on permutte NX et NY ds l'entete LibIDO */</span>
00581    <span class="keywordtype">int</span> secuDim;
00582    secuDim = dim[0];
00583    dim[0]  = dim[1];
00584    dim[1]  = secuDim;
00585   }
00586 
00587   *NT = *NZ = *NY = *NX = 1; <span class="comment">/* CO 6/5/96 */</span>
00588   <span class="keywordflow">switch</span>(ndim) {
00589    <span class="keywordflow">case</span> 4: *NT=dim[3];
00590    <span class="keywordflow">case</span> 3: *NZ=dim[2];
00591    <span class="keywordflow">case</span> 2: *NY=dim[1];
00592    <span class="keywordflow">case</span> 1: *NX=dim[0];
00593   } 
00594 
00595   <span class="keywordflow">switch</span> (ndim) {
00596       <span class="keywordflow">case</span>  1: *typObj=<a class="code" href="idgen_8h.html#a11">SIG</a>; <span class="keywordflow">break</span>;
00597       <span class="keywordflow">case</span>  2: *typObj=<a class="code" href="idgen_8h.html#a7">IMA</a>; <span class="keywordflow">break</span>;
00598       <span class="keywordflow">case</span>  3: *typObj=<a class="code" href="idgen_8h.html#a10">VOL</a>; <span class="keywordflow">break</span>;
00599       <span class="keywordflow">case</span>  4: *typObj=<a class="code" href="idgen_8h.html#a9">SEQ</a>; <span class="keywordflow">break</span>;
00600       <span class="keywordflow">default</span>: {
00601      <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00602      fclose ( fp );
00603      <span class="keywordflow">return</span> (0);
00604       }
00605  }
00606                      <span class="comment">/* nombre de bits par pixels (Bits Allocated) */</span>
00607     <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0100,fp,&amp;nb)) {
00608 
00609      <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00610           fclose ( fp );
00611      <span class="keywordflow">return</span> (0);
00612      }   
00613      *bitsAllocated = nb;
00614                         <span class="comment">/* nombre de bits utiles (Bits Stored) */</span>
00615     <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0101,fp,&amp;nbu)) {
00616 
00617    nbu=nb;
00618     }
00619     *bitsStored = nbu;
00620                         <span class="comment">/* Bit de poids fort (High Bit ) */</span>
00621     <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0102,fp,&amp;hb)) {
00622 
00623    hb=nbu-1;
00624     }
00625     *highBit = hb;
00626 
00627                   <span class="comment">/* type 'signe' ou 'non signe ' **/</span>
00628     <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0103,fp,&amp;ty)) {
00629 
00630    ty=0; 
00631     }
00632     *signe = ty;
00633 <span class="comment">/*</span>
00634 <span class="comment">    if (*typData != TY_RGB) {</span>
00635 <span class="comment">      *typData=_IdAcrCheckType(fp, bufbid, (int)ty, (int)nb, *typObj);</span>
00636 <span class="comment">    }</span>
00637 <span class="comment">    *typLibido = *typData &amp; TY_SIZE;</span>
00638 <span class="comment">*/</span>
00639 
00640     *typLibido=<a class="code" href="idacr-restricted_8h.html#a26">_IdAcrCheckType</a>(fp, bufbid, (<span class="keywordtype">int</span>)ty, (<span class="keywordtype">int</span>)nb, *typObj);
00641 
00642     *typData = *typLibido &amp; <a class="code" href="idgen_8h.html#a18">TY_SIZE</a>;
00643 
00644 
00645    <span class="comment">/* IdPrintf (" typData %x\n",*typData); */</span>
00646 
00647     *offset = <a class="code" href="idacr-restricted_8h.html#a27">_IdAcrGetPixelOffset</a>(fp);
00648 
00649     fclose ( fp );
00650 
00651   <span class="keywordflow">return</span> 1;
00652 }
00653 
00654 <span class="comment">/* FoNCTION DESCRIPTIoN **************************************************</span>
00655 <span class="comment">* </span>
00656 <span class="comment">* _IdAcrGetPixelOffset  (fonction)</span>
00657 <span class="comment">* </span>
00658 <span class="comment">* ReSUME: Retourne l'offset pour atteindre le groupe des Pixels stocke dans l'entete ACRNEMA.</span>
00659 <span class="comment">* </span>
00660 <span class="comment">* DeSCRIPTION: Retourne l'offset pour atteindre le groupe des Pixels stocke dans l'entete ACRNEMA..</span>
00661 <span class="comment">* </span>
00662 <span class="comment">* SyNTAXE:     long offset = _IdAcrGetPixelOffset(fp)</span>
00663 <span class="comment">* </span>
00664 <span class="comment">* </span>
00665 <span class="comment">* FICHIER:     readacr.c</span>
00666 <span class="comment">* </span>
00667 <span class="comment">*     fseek(fp,4L,SEEK_SET);     SEEK_SET = 0                   </span>
00668 <span class="comment">*     fread(&amp;bili2,4,1,fp);      lgr groupe : 0000 0004   JPR       </span>
00669 <span class="comment">*     sw=_IdAcrTestSwap(bili2);                           JPR   </span>
00670 <span class="comment">* </span>
00671 <span class="comment">* </span>
00672 <span class="comment">* EXEMPLE:     </span>
00673 <span class="comment">*        </span>
00674 <span class="comment">******************************************************** END DESCRIPTIoN */</span>
00675 
00676 
<a name="l00677"></a><a class="code" href="idacr-restricted_8h.html#a27">00677</a> <span class="keywordtype">long</span> <a class="code" href="idacr-restricted_8h.html#a27">_IdAcrGetPixelOffset</a>(FILE *fp)
00678 {
00679    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> g,gr;
00680    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> n,num;
00681    <span class="keywordtype">int</span> l;
00682    <span class="keywordtype">int</span> flag;
00683    <span class="keywordtype">int</span> skL;
00684    <span class="keywordtype">int</span> lgrTot=<a class="code" href="acrread_8c.html#a12">__ID_offset</a>;
00685    
00686    <span class="keywordtype">int</span> __cas_de_fou_Philips =0;
00687 
00688    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00689       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" _IdAcrGetPixelOffset : __ID_offset = %d\n"</span>,<a class="code" href="acrread_8c.html#a12">__ID_offset</a>);
00690 
00691 
00692    <span class="comment">/* --- pour remettre le pointeur de fichier d'applomb --- */</span>
00693    <span class="comment">/* --- et pour positionner __ID_offset       --- */</span>
00694    <span class="comment">/* pas tres elegant --&gt; trouver autre chose ?      --- */</span>
00695       sw=<a class="code" href="idacr-restricted_8h.html#a8">_IdAcrCheckSwap</a>(fp);
00696 
00697    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00698       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" \n_IdAcrGetPixelOffset : sortie _IdAcrCheckSwap\n\n"</span>);
00699 
00700    <span class="keywordflow">if</span> ( <a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a> == 1)
00701       {
00702       printf(<span class="stringliteral">"ID_CardioVascCurieux : 3\n"</span>);
00703       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00704          <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">" _IdAcrGetPixelOffset : __ID_CardioVascCurieux = 1\n"</span>);
00705       fseek(fp,0L,<a class="code" href="volrdf_8c.html#a0">SEEK_SET</a>);
00706       }
00707 
00708    <span class="comment">// -------</span>
00709 
00710    <span class="keywordflow">if</span>(!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0200,fp,&amp;gr))
00711                 gr=0x7FE0;   <span class="comment">// Par defaut</span>
00712    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00713       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" _IdAcrGetPixelOffset : numGrPixels %x\n"</span>,gr);
00714 
00715    <span class="keywordflow">if</span> (!(gr==0x7FE0))
00716       num=0x1010;  <span class="comment">// Special PHILIPS</span>
00717    <span class="keywordflow">else</span>
00718       num=0x0010;
00719 
00720    <span class="keywordflow">if</span> (<a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a> == 1) {
00721       num=0x0010;    <span class="comment">// Special PHILIPS</span>
00722       printf(<span class="stringliteral">"ID_CardioVascCurieux : 4\n"</span>);
00723    }
00724 
00725    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00726       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" _IdAcrGetPixelOffset : numEltPixels %x\n"</span>,num);
00727 
00728    <span class="comment">// -------</span>
00729 
00730    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00731       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">" _IdAcrGetPixelOffset : Recherche gr %x  num"</span>
00732          <span class="stringliteral">"%x (swapping %d)\n"</span>,gr,num,sw); 
00733 
00734    <span class="comment">/* --- pour remettre le pointeur de fichier d'applomb --- */</span>
00735    <span class="comment">/* pas tres elegant --&gt; trouver autre chose ?      --- */</span>
00736       sw=<a class="code" href="idacr-restricted_8h.html#a8">_IdAcrCheckSwap</a>(fp);
00737 
00738    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00739       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" _IdAcrGetPixelOffset : sortie _IdAcrCheckSwap\n"</span>);
00740 
00741    <span class="keywordflow">if</span> ( <a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a> == 1)
00742       {
00743       printf(<span class="stringliteral">"ID_CardioVascCurieux : 5\n"</span>);
00744       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00745          <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">" _IdAcrGetPixelOffset : __ID_CardioVascCurieux = 1\n"</span>);
00746       fseek(fp,0L,<a class="code" href="volrdf_8c.html#a0">SEEK_SET</a>);
00747       }
00748 
00749    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00750       <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">" \n_IdAcrGetPixelOffset : On lance le comptage\n\n"</span>);
00751 
00752    l=0;
00753    flag=0;
00754 
00755 
00756    <span class="keywordflow">while</span>(fread(&amp;g,2,1,fp)) {
00757       <span class="keywordflow">if</span>(sw)
00758          g=<a class="code" href="acrutil_8c.html#a17">SWAP_SHORT</a>(((<span class="keywordtype">short</span>)g));
00759       fread(&amp;n,2,1,fp);
00760       <span class="keywordflow">if</span>(sw)
00761          n=<a class="code" href="acrutil_8c.html#a17">SWAP_SHORT</a>(((<span class="keywordtype">short</span>)n));
00762       l= <a class="code" href="acrutil_8c.html#a14">_IdAcrRecupLgr</a>(fp, &amp;skL);
00763       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00764          <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">" _IdAcrGetPixelOffset : fread g %x "</span>
00765             <span class="stringliteral">"n %x l %d 0x%08x\n"</span>,g,n,l,l);
00766       
00767       <span class="keywordflow">if</span>((g==gr)&amp;&amp;(n==num)) {
00768          <span class="comment">// on est sur l'element recherche</span>
00769          lgrTot = lgrTot + 2 +2 + skL; 
00770    
00771          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00772             <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">"_IdAcrGetPixelOffset : sortie avec offset  %d\n"</span>,
00773                      lgrTot); 
00774          <span class="keywordflow">return</span> lgrTot;
00775 
00776       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(  ( (g&gt;gr)||((gr==g)&amp;&amp;(n&gt;num)) ) &amp;&amp;
00777             ( g &lt; 0xff00 )    <span class="comment">// cas de fou Phiplips</span>
00778                              ) {
00779          <span class="comment">// on a depasse l'element</span>
00780             <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">"_IdAcrGetPixelOffset : Kross Katastrof : on a depasse"</span> 
00781                 <span class="stringliteral">"  le groupe des Pixels :-( \n"</span>);
00782       } <span class="keywordflow">else</span> {  <span class="comment">// on saute a l'element suivant</span>
00783          <span class="keywordflow">if</span> (g&gt;0xff00) {
00784             <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)<a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">"_IdAcrGetPixelOffset : cas de fou Phiplips\n"</span>);
00785             __cas_de_fou_Philips=1;
00786          }
00787          fseek(fp,l,<a class="code" href="simri3d_8h.html#a15">SEEK_CUR</a>);
00788          lgrTot = lgrTot + l +2 +2 +skL;
00789          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00790             <a class="code" href="kerprint_8c.html#a4">IdPrintf</a>(<span class="stringliteral">"_IdAcrGetPixelOffset : on saute a "</span>
00791                <span class="stringliteral">"l ele sv : lgrTot (part) %d\n"</span>, 
00792                lgrTot); 
00793       }
00794    } <span class="comment">// While</span>
00795    <span class="keywordflow">return</span>(0);
00796 }
00797 
00798 <span class="comment">/* ----------------------------------------------------------------------- */</span>
00799 
<a name="l00809"></a><a class="code" href="idacr_8h.html#a106">00809</a> <span class="keywordtype">long</span> <a class="code" href="idacr_8h.html#a106">IdAcrGetPixelOffsetFromFile</a>(<span class="keywordtype">char</span> *filename)
00810 {
00811    FILE *fp;
00812    <span class="keywordtype">long</span> result;
00813    <span class="keywordflow">if</span>((fp=fopen(filename,<a class="code" href="idio_8h.html#a0">ID_RFILE_BIN</a>))==0) {
00814       <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a> (<span class="stringliteral">"echec ouverture  %s\n"</span>, filename);
00815       <span class="keywordflow">return</span> (0);
00816         }
00817    result = <a class="code" href="idacr-restricted_8h.html#a27">_IdAcrGetPixelOffset</a>(fp);
00818    fclose(fp);
00819    <span class="keywordflow">return</span> result;
00820 }
00821 
00822 
00823 <span class="comment">/* ----------------------------------------------------------------------- */</span>
00824 
00825 
<a name="l00854"></a><a class="code" href="idacr_8h.html#a72">00854</a> <span class="keywordtype">void</span> *<a class="code" href="idacr_8h.html#a72">IdAcrReadFile</a>(<span class="keywordtype">char</span> * filename, <span class="keywordtype">int</span> type)
00855 {
00856 <span class="keywordtype">void</span> ** tabObj=NULL;
00857 
00858 tabObj=<a class="code" href="idacr_8h.html#a74">IdAcrReadFileIntoVector</a>(filename, type,-2, -2, NULL);
00859 
00860 <span class="keywordflow">if</span> (tabObj==NULL) 
00861    <span class="keywordflow">return</span> (NULL);
00862 <span class="keywordflow">else</span>
00863    <span class="keywordflow">return</span>(tabObj[0]);
00864 }
00865 
00866 
00867 <span class="comment">//-------------------------------------------------------------------------</span>
00868 <span class="comment">//</span>
00869 <span class="comment">// IdDcmCVReadFile est une encapsulation de IdAcrReadFileIntoVector</span>
00870 <span class="comment">//</span>
00871 
<a name="l00904"></a><a class="code" href="idacr_8h.html#a73">00904</a> <span class="keywordtype">void</span> *<a class="code" href="idacr_8h.html#a73">IdDcmCVReadFile</a>(<span class="keywordtype">char</span> * filename, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> numPremIm, <span class="keywordtype">int</span> numDernIm)
00905 {
00906 <span class="keywordtype">void</span> ** tabObj=NULL;
00907 
00908 tabObj=<a class="code" href="idacr_8h.html#a74">IdAcrReadFileIntoVector</a>(filename,type, numPremIm, numDernIm, NULL);
00909 
00910 <span class="keywordflow">if</span> (tabObj==NULL) 
00911    <span class="keywordflow">return</span> (NULL);
00912 <span class="keywordflow">else</span>
00913    <span class="keywordflow">return</span>(tabObj[0]);
00914 }
00915 
00916 
00917 <span class="comment">/* FUNCTION DESCRIPTION **************************************************</span>
00918 <span class="comment"></span>
00919 <span class="comment">IdAcrInquireHeader  (fonction)</span>
00920 <span class="comment"></span>
00921 <span class="comment">RESUME: Retourne TOUTES les info stockees dans l'entete ACRNEMA.</span>
00922 <span class="comment"></span>
00923 <span class="comment">DESCRIPTION: Retourne TOUTES les info sur l'objet stocke dans un fichier ACRNEMA.</span>
00924 <span class="comment">        sous forme d'une liste d'ACR_ELEMENT.</span>
00925 <span class="comment">        la 'valeur' de chaque element est suivie d'un ZERO binaire, </span>
00926 <span class="comment">        car il est IMPOSSIBLE ( pour IdAcrInquireHeader) de savoir, </span>
00927 <span class="comment">        dans le cas d'un element d'un groupe prive (impair),</span>
00928 <span class="comment">          si un element de longueur 2 est un UNSIGNED SHORT INT ou un CHAR *...</span>
00929 <span class="comment">          si un element de longueur 4 est un UNSIGNED LONG      ou un CHAR *...</span>
00930 <span class="comment"></span>
00931 <span class="comment">       L'utilisateur desirant connaitre connaitre la valeur d'un element particulier</span>
00932 <span class="comment">       saura, en consultant le 'Conformance Statement' de l'imageur sur lequel il travaille</span>
00933 <span class="comment">       le type de cet element.</span>
00934 <span class="comment">       il procedera alors comme suit:</span>
00935 <span class="comment">    </span>
00936 <span class="comment">   unsigned short int gr =0x0010;        ..  par exemple ..</span>
00937 <span class="comment">   unsigned short int num=0x0010;</span>
00938 <span class="comment">   ACR_ELEMENT *elem=_IdAcrFindElement(liste,gr,num);</span>
00939 <span class="comment">   uint32_t lgr = elem-&gt;length;</span>
00940 <span class="comment"></span>
00941 <span class="comment">       Selon que :</span>
00942 <span class="comment"></span>
00943 <span class="comment">       c'est un char * de lgr !=2, !=4</span>
00944 <span class="comment">      On l'utilisera directement :  printf("%s\n",elem-&gt;value);</span>
00945 <span class="comment"></span>
00946 <span class="comment">       c'est un char * de lgr =4 </span>
00947 <span class="comment">      On le Swappera :     *(long *)elem-&gt;value=SWAP_LONG((*(long*)elem-&gt;value));</span>
00948 <span class="comment">                  printf("%s\n",elem-&gt;value);</span>
00949 <span class="comment">       c'est un char * de lgr =2 </span>
00950 <span class="comment">      On le Swappera :     *(long *)elem-&gt;value=SWAP_SHORT((*(long*)elem-&gt;value));</span>
00951 <span class="comment">                  printf("%s\n",elem-&gt;value);</span>
00952 <span class="comment">       c'est un short int</span>
00953 <span class="comment">      On le castera :         unsigned short int x = *(short int *) elem-&gt;value;</span>
00954 <span class="comment"></span>
00955 <span class="comment">       c'est un long int</span>
00956 <span class="comment">      On le castera :         unsigned long x  = *(unsigned long *) elem-&gt;value;</span>
00957 <span class="comment"></span>
00958 <span class="comment">Bon...</span>
00959 <span class="comment">On a vu pire...         </span>
00960 <span class="comment"></span>
00961 <span class="comment">SYNTAXE:     ACR_ELEMENT *liste = IdAcrInquireHeader (char *filename, int mode);</span>
00962 <span class="comment"></span>
00963 <span class="comment">RETOUR:      type  : ACR_ELEMENT *</span>
00964 <span class="comment">        role  : liste d'ACR_ELEMENT</span>
00965 <span class="comment"></span>
00966 <span class="comment">PARAMETRES:</span>
00967 <span class="comment">        nom   : filename</span>
00968 <span class="comment">        type  : char *</span>
00969 <span class="comment">        role  : Nom du fichier ACRNEMA</span>
00970 <span class="comment"></span>
00971 <span class="comment">        nom   : mode</span>
00972 <span class="comment">        type  : integer</span>
00973 <span class="comment">        role:</span>
00974 <span class="comment">      mode= 0 : on NE CHARGE PAS    les Elements 'longs' (&gt;5000) ,</span>
00975 <span class="comment">           1 : on charge EGALEMENT les Elements 'longs' (&gt;5000) ,             </span>
00976 <span class="comment">               2 : on NE charge PAS les Groupes Shadow (ni Elts Longs)</span>
00977 <span class="comment"> </span>
00978 <span class="comment"></span>
00979 <span class="comment">FICHIER : readacr.c</span>
00980 <span class="comment"></span>
00981 <span class="comment"></span>
00982 <span class="comment">******************************************************** END DESCRIPTION */</span>
00983 
<a name="l01029"></a><a class="code" href="idacr-restricted_8h.html#a3">01029</a> <a class="code" href="structacr__element.html">ACR_ELEMENT</a> * <a class="code" href="idacr-restricted_8h.html#a3">IdAcrInquireHeader</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> mode)
01030 {
01031 FILE * fp;
01032 <a class="code" href="structacr__element.html">ACR_ELEMENT</a> *p, *liste=NULL;
01033 
01034    <span class="keywordflow">if</span>((fp=fopen(filename,<a class="code" href="idio_8h.html#a0">ID_RFILE_BIN</a>))==0) { 
01035       <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a> (<span class="stringliteral">"echec ouverture  %s\n"</span>,filename);
01036       <span class="keywordflow">return</span> (NULL);
01037         }
01038    sw= <a class="code" href="idacr-restricted_8h.html#a8">_IdAcrCheckSwap</a>(fp);
01039 
01040    <span class="keywordflow">if</span> (<a class="code" href="acrread_8c.html#a11">__ID_CardioVascCurieux</a>) {
01041       fseek(fp,0L,<a class="code" href="volrdf_8c.html#a0">SEEK_SET</a>);
01042       printf(<span class="stringliteral">"ID_CardioVascCurieux : 6\n"</span>);
01043    }
01044 
01045    <span class="keywordflow">if</span>(sw==-1) { 
01046       <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a> (<span class="stringliteral">"fichier %s non ACR\n"</span>,filename);
01047       <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
01048       <span class="keywordflow">return</span> (NULL);
01049         }
01050    <a class="code" href="acrread_8c.html#a14">__NumeroGroupePrecedent</a> = 0; <span class="comment">/*Pour etre sur que le premier sera + grand */</span>
01051 
01052    <span class="keywordflow">while</span> ( (p=<a class="code" href="idacr-restricted_8h.html#a14">_IdAcrReadNextElement</a>(fp,mode)) ) {
01053       <span class="keywordflow">if</span> (mode==2) {
01054          <span class="keywordflow">if</span>(!(p-&gt;<a class="code" href="structacr__element.html#o0">group</a>%2)) {
01055             liste=<a class="code" href="idacr-restricted_8h.html#a11">_IdAcrAppendElement</a>(liste,p);
01056          }
01057       } <span class="keywordflow">else</span> {
01058          liste=<a class="code" href="idacr-restricted_8h.html#a11">_IdAcrAppendElement</a>(liste,p);
01059       }
01060    }
01061    <span class="keywordflow">return</span> (liste);
01062 }
01063 
01064 
01065 <span class="comment">/* </span>
01066 <span class="comment">* ------------------------------------------------------------------------------------------------------ </span>
01067 <span class="comment">*/</span>
01068 
01069 <span class="comment">/* ------------------------------------------------------------ */</span>
01070 <span class="comment">/* A partir d'un fichier Acr deja ouvert,          */</span>
01071 <span class="comment">/* ds lequel on deja lu bufbid (8,10)           */</span>
01072 <span class="comment">/*                et ty (signe : ( 28,103)         */</span>
01073 <span class="comment">/* on cherche le type stocke  ( 28,105 ou 28,199 )    */</span>
01074 <span class="comment">/*         ou le type deduit  ( a partir de nb et de ty )   */</span>
01075 <span class="comment">/*                      */</span>
01076 <span class="comment">/*    retourne -1 si rien trouve ou rien deduit       */</span>
01077 <span class="comment">/* ------------------------------------------------------------ */</span>
01078 
<a name="l01079"></a><a class="code" href="idacr-restricted_8h.html#a26">01079</a> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="idacr-restricted_8h.html#a26">_IdAcrCheckType</a>(FILE * fp, <span class="keywordtype">char</span> * bufbid, <span class="keywordtype">int</span> ity, <span class="keywordtype">int</span> inb, <span class="keywordtype">int</span> itypObj)
01080 {
01081 <span class="keywordtype">long</span> <span class="keywordtype">int</span> lgrMessage;
01082 <span class="keywordtype">short</span> <span class="keywordtype">int</span> typ;
01083 <span class="keywordtype">short</span> <span class="keywordtype">int</span> ty=ity;
01084 <span class="keywordtype">short</span> <span class="keywordtype">int</span> nb=inb;
01085 <span class="keywordtype">short</span> <span class="keywordtype">int</span> typObj=itypObj;
01086 
01087 
01088 <span class="keywordflow">if</span> (nb==12) nb=8;
01089 
01090 typ= -1;
01091 <span class="keywordflow">if</span> (  (memcmp(bufbid,<span class="stringliteral">"ACRNEMA_LIBIDO"</span>,14)==0)      <span class="comment">/* si c'est egal                  */</span>
01092      ||
01093       (memcmp(bufbid,<span class="stringliteral">"CANRME_AILIBOD"</span>,14)==0)      <span class="comment">/* (en cas d'objet ACRLibido fait sr 1 autre machine) */</span>
01094     ) {
01095    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">"on a trouve ACR LIBIDO\n"</span>); 
01096 
01097    <span class="keywordflow">if</span> (!<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0105,fp,&amp;typ))           <span class="comment">/* on cherche 28,105               */</span>
01098          <a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0199,fp,&amp;typ) ;      <span class="comment">/* si pas trouve on cherche 28,199 */</span>
01099       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">"type lu sur disque %x\n"</span>,typ); 
01100 }
01101 
01102 <span class="keywordflow">if</span> (typ==-1) {                <span class="comment">/* on n a rien trouve (ce n'EST PAS un fichier ACR-LibIDO nouvelle version)  */</span>
01103    
01104                               <span class="comment">/* debut usine a gaz    */</span>
01105 
01106         <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a52">TA_TY_UCHAR</a>*8) &amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>;      <span class="comment">/*  JPR */</span>
01107    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a51">TA_TY_CHAR</a>*8)  &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>;
01108    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a59">TA_TY_USHORT</a>*8)&amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>;
01109    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a58">TA_TY_SHORT</a>*8) &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>;
01110    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a61">TA_TY_ULONG</a>*8) &amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>;
01111    <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a60">TA_TY_LONG</a>*8)  &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a25">TY_LONG</a>;
01112 
01113    <span class="comment">/*   ATTENTION : les representations internes des types FLOAT et DOUBLE</span>
01114 <span class="comment">        sont machine-dependent</span>
01115 <span class="comment">   */</span>
01116 
01117       <span class="comment">/* les anciens float et doubles n etaient pas signes.... */</span>
01118 
01119    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a53">TA_TY_FLOAT</a>*8) <span class="comment">/* &amp;&amp; (ty==1) */</span> ) typ = typObj | <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>;
01120    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a54">TA_TY_DOUBLE</a>*8)<span class="comment">/* &amp;&amp; (ty==1) */</span> ) typ = typObj | <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>;     <span class="comment">/*  JPR */</span>
01121       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==3*<a class="code" href="idgen_8h.html#a52">TA_TY_UCHAR</a>*8)&amp;&amp;(ty==0))     typ = typObj | <a class="code" href="idgen_8h.html#a23">TY_RGB</a>;        <span class="comment">/*BB  6-JUL-1992 */</span>
01122    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a62">TA_TY_COMPLEX_DOUBLE</a>*8))       typ = typObj | <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>;
01123 
01124    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">"Entete : nb=%d typObj=%x; Type deduit=%x\n"</span>,
01125             nb,typObj,typ);  
01126 
01127    <span class="comment">/* ce N'EST PAS un fichier LibIDO   */</span>
01128 
01129    _message=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01130    lgrMessage=0;
01131             
01132   } <span class="keywordflow">else</span> {     <span class="comment">/* fin usine a gaz    */</span>
01133  
01134       <span class="comment">/* C'EST un fichier LibIDO */</span>
01135       <span class="comment">/* on regarde si 'message' contient qq chose */</span>
01136 
01137    lgrMessage= <a class="code" href="idacr-restricted_8h.html#a24">_IdAcrGetElementLength</a>(0x0028,0x0198,fp);
01138    <span class="keywordflow">if</span> (lgrMessage !=0) { 
01139       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) <a class="code" href="kerprint_8c.html#a4">IdPrintf</a> (<span class="stringliteral">"lgrMessage %ld\n"</span>, lgrMessage);  
01140       _message=(<span class="keywordtype">char</span> *)malloc(lgrMessage+1);
01141       <span class="keywordflow">if</span> (!_message) {
01142             <a class="code" href="kerprint_8c.html#a5">IdErrPrintf</a>(<span class="stringliteral">"Impossible d allouer de la place pour _message ...\n"</span>);
01143             _message=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01144       }
01145       <span class="keywordflow">else</span>
01146 
01147          <a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0028,0x0198,fp,_message) ;    <span class="comment">/*  on cherche 28,198  JPR */</span>
01148    }
01149    <span class="keywordflow">else</span>
01150       _message=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01151   }
01152   _message[lgrMessage]=<span class="charliteral">'\0'</span>;  <span class="comment">/* Djamal Boukerroui */</span>
01153 
01154   <span class="keywordflow">return</span> typ;
01155 }
01156 
01157 
01158 
01159 
01160 
01161 
01162 <span class="comment">/* FUNCTION DESCRIPTION **************************************************</span>
01163 <span class="comment"></span>
01164 <span class="comment">IdAcrInquireInfo  (fonction)</span>
01165 <span class="comment">IdAcrInquireInfoTot  (fonction)</span>
01166 <span class="comment">IdAcrInquireInfoTot2  (fonction)</span>
01167 <span class="comment">IdAcrInquireInfoTot3  (fonction)</span>
01168 <span class="comment"></span>
01169 <span class="comment">RESUME: Retourne diverses info stockees dans l'entete ACRNEMA.</span>
01170 <span class="comment"></span>
01171 <span class="comment">DESCRIPTION: NE PLUS UTILISER !! Retourne des info sur l'objet stocke dans un fichier ACRNEMA.</span>
01172 <span class="comment"></span>
01173 <span class="comment">   Remplace par IdAcrInquireInfoTot4, car incomplet</span>
01174 <span class="comment">   On doit le laisser, car est peut etre utilise par de vieux programmes</span>
01175 <span class="comment"></span>
01176 <span class="comment">******************************************************** END DESCRIPTION */</span>
01177 
<a name="l01178"></a><a class="code" href="idacr-restricted_8h.html#a28">01178</a> <span class="keywordtype">int</span> <a class="code" href="idacr-restricted_8h.html#a28">IdAcrInquireInfo</a> ( <span class="keywordtype">char</span> * filename,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData,<span class="keywordtype">int</span> *NX,<span class="keywordtype">int</span> *NY,<span class="keywordtype">int</span> *NZ,<span class="keywordtype">int</span> *offset )
01179 {
01180 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> typLibido;
01181 <span class="keywordtype">int</span> NT;
01182 <span class="keywordtype">int</span> nbFrames;
01183 <span class="keywordtype">int</span> codeSwap;
01184 <span class="keywordtype">int</span> nb;
01185 <span class="keywordtype">int</span> nbu;
01186 <span class="keywordtype">int</span> hb;
01187 <span class="keywordtype">int</span> signe;
01188 <span class="keywordflow">return</span> ( <a class="code" href="idacr_8h.html#a102">IdAcrInquireInfoTot4</a> ( filename,typObj,&amp;typLibido,typData,NX,NY,NZ,&amp;NT,offset,&amp;nbFrames,&amp;codeSwap,&amp;nb,&amp;nbu,&amp;hb,&amp;signe ) );
01189 
01190 }
01191 
01192 <span class="comment">/* -------------------- */</span>
01193 
<a name="l01194"></a><a class="code" href="idacr-restricted_8h.html#a29">01194</a> <span class="keywordtype">int</span> <a class="code" href="idacr-restricted_8h.html#a29">IdAcrInquireInfoTot</a> ( <span class="keywordtype">char</span> * filename, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData, <span class="keywordtype">int</span> *NX, <span class="keywordtype">int</span> *NY, <span class="keywordtype">int</span> *NZ, <span class="keywordtype">int</span> *NT, <span class="keywordtype">int</span> *offset )
01195 {
01196 <span class="keywordtype">int</span> nbFrames;
01197 <span class="keywordtype">int</span> codeSwap;
01198 <span class="keywordtype">int</span> nb;
01199 <span class="keywordtype">int</span> nbu;
01200 <span class="keywordtype">int</span> hb;
01201 <span class="keywordtype">int</span> signe;
01202 <span class="keywordflow">return</span> ( <a class="code" href="idacr_8h.html#a102">IdAcrInquireInfoTot4</a> ( filename,typObj,typLibido,typData,NX,NY,NZ,NT,offset,&amp;nbFrames,&amp;codeSwap,&amp;nb,&amp;nbu,&amp;hb,&amp;signe ) );
01203 }
01204 
01205 <span class="comment">/* -------------------- */</span>
01206 
<a name="l01207"></a><a class="code" href="idacr-restricted_8h.html#a30">01207</a> <span class="keywordtype">int</span> <a class="code" href="idacr-restricted_8h.html#a30">IdAcrInquireInfoTot2</a> ( <span class="keywordtype">char</span> * filename, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData, <span class="keywordtype">int</span> *NX, <span class="keywordtype">int</span> *NY, <span class="keywordtype">int</span> *NZ, <span class="keywordtype">int</span> *NT, <span class="keywordtype">int</span> *offset, <span class="keywordtype">int</span> *nbFrames )
01208 {
01209 <span class="keywordtype">int</span> codeSwap;
01210 <span class="keywordtype">int</span> nb;
01211 <span class="keywordtype">int</span> nbu;
01212 <span class="keywordtype">int</span> hb;
01213 <span class="keywordtype">int</span> signe;
01214 <span class="keywordflow">return</span> ( <a class="code" href="idacr_8h.html#a102">IdAcrInquireInfoTot4</a> ( filename,typObj,typLibido,typData,NX,NY,NZ,NT,offset,nbFrames,&amp;codeSwap,&amp;nb,&amp;nbu,&amp;hb,&amp;signe ) );
01215 }
01216 
01217 <span class="comment">/* -------------------- */</span>
01218 
<a name="l01219"></a><a class="code" href="idacr-restricted_8h.html#a31">01219</a> <span class="keywordtype">int</span> <a class="code" href="idacr-restricted_8h.html#a31">IdAcrInquireInfoTot3</a> ( <span class="keywordtype">char</span> * filename, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData, <span class="keywordtype">int</span> *NX, <span class="keywordtype">int</span> *NY, <span class="keywordtype">int</span> *NZ, <span class="keywordtype">int</span> *NT, <span class="keywordtype">int</span> *offset, <span class="keywordtype">int</span> *nbFrames, <span class="keywordtype">int</span> *codeSwap )
01220 {
01221 <span class="keywordtype">int</span> nb;
01222 <span class="keywordtype">int</span> nbu;
01223 <span class="keywordtype">int</span> hb;
01224 <span class="keywordtype">int</span> signe;
01225 <span class="keywordflow">return</span> ( <a class="code" href="idacr_8h.html#a102">IdAcrInquireInfoTot4</a> ( filename,typObj,typLibido,typData,NX,NY,NZ,NT,offset,nbFrames,codeSwap,&amp;nb,&amp;nbu,&amp;hb,&amp;signe ) );
01226 }
01227 
01228 
01229 <span class="comment">/* -------------------- */</span>
01230 
<a name="l01231"></a><a class="code" href="acrread_8c.html#a18">01231</a> <span class="keywordtype">int</span> <a class="code" href="acrread_8c.html#a18">_IdAcrIsAcrLibido</a>(FILE *fp,<span class="keywordtype">char</span> *bufbid)
01232 {
01233    <span class="keywordflow">if</span> ( <a class="code" href="acrread_8c.html#a15">__TrueDicom</a> == 0) {
01234       <span class="comment">// Recognition Code  --&gt; n'existe plus en DICOM V3 ...</span>
01235       <span class="comment">//</span>
01236       <span class="comment">// ACR_NEMA 1.0 ou ACRNEMA_LIBIDO_1.1</span>
01237       <span class="comment">// On le lit ici pour eviter de revenir en arriere</span>
01238 
01239       <span class="keywordflow">if</span>(<a class="code" href="idacr-restricted_8h.html#a21">_IdAcrReadElement</a>(0x0008,0x0010,fp,bufbid)!=0) { 
01240 
01241          <span class="keywordflow">if</span> (  (memcmp(bufbid,<span class="stringliteral">"ACRNEMA_LIBIDO"</span>,14)==0)
01242             <span class="comment">// si c'est egal</span>
01243             || (memcmp(bufbid,<span class="stringliteral">"CANRME_AILIBOD"</span>,14)==0))
01244             <span class="comment">// en cas d'objet ACRLibido fait sr 1 autre machine) </span>
01245                <span class="keywordflow">return</span>(1);
01246       }
01247    }
01248 
01249    <span class="keywordflow">return</span>(0);
01250 }
01251 
01252 
01253 <span class="comment">/* -------------------- */</span>
01254 
<a name="l01255"></a><a class="code" href="idacr-private_8h.html#a0">01255</a> <span class="keywordtype">void</span> <a class="code" href="idacr-private_8h.html#a0">_IdAcrPositionSwap</a>(FILE* fp)
01256 {
01257     sw = <a class="code" href="idacr-restricted_8h.html#a8">_IdAcrCheckSwap</a>(fp);
01258 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:13 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
