<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: seq-se.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>seq-se.c</h1><a href="seq-se_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: seq-se.c,v 1.9 2006/12/18 15:10:38 yougz Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 2.0  20/12/2006</span>
00034 <span class="comment">*************************************************************************/</span>
00035 <span class="preprocessor">#include "<a class="code" href="seq-se_8h.html">seq-se.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="event-rfpulse_8h.html">event-rfpulse.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="event-precession_8h.html">event-precession.h</a>"</span>
00038 <span class="preprocessor">#include "<a class="code" href="event-acquisition_8h.html">event-acquisition.h</a>"</span>
00039 <span class="preprocessor">#include "<a class="code" href="seq-mpi_8h.html">seq-mpi.h</a>"</span>
00040 
00041 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga20">SeqSpinEcho1D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00042 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga21">SeqSpinEcho2D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00043 <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga22">SeqSpinEcho3D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr);
00044 
<a name="l00054"></a><a class="code" href="group__Sequence.html#ga16">00054</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga16">SeqSpinEcho1D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00055 {
00056    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam, expr, <a class="code" href="group__Sequence.html#ga20">SeqSpinEcho1D_0</a>);
00057    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00058    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00059 }
00060 
<a name="l00070"></a><a class="code" href="group__Sequence.html#ga17">00070</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga17">SeqSpinEcho2D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00071 {
00072    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam , expr, <a class="code" href="group__Sequence.html#ga21">SeqSpinEcho2D_0</a>);
00073    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00074    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00075 }
00076 
<a name="l00086"></a><a class="code" href="group__Sequence.html#ga18">00086</a> <a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a> <a class="code" href="group__Sequence.html#ga18">SeqSpinEcho3D</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00087 {
00088    <a class="code" href="seq-mpi_8h.html#a1">mpi_job</a>(seqparam, expr, <a class="code" href="group__Sequence.html#ga22">SeqSpinEcho3D_0</a>);
00089    <a class="code" href="group__Experience.html#ga25">NormalizeRFSignal</a>(expr);
00090    <span class="keywordflow">return</span>(<a class="code" href="group__Experience.html#ga28">GetSignalRFComplexFromExperience</a>(expr));
00091 }
00092 
<a name="l00101"></a><a class="code" href="group__Sequence.html#ga0">00101</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga0">CheckTimesSE</a>(<span class="keywordtype">double</span> tacq,<span class="keywordtype">double</span> te,<span class="keywordtype">double</span> tr)
00102 {
00103    <span class="keywordtype">int</span> f=0;
00104    <span class="keywordflow">if</span>((tacq&lt;te)&amp;&amp;(tr&gt;te+tacq/2.0))f=1;
00105    <span class="keywordflow">if</span>(f==0){
00106       <a class="code" href="simri3d_8h.html#a18">FPRINTF</a>(stderr,<span class="stringliteral">"Bad values for your sequence SE: Tacq=%g, Te=%g, Tr=%g\n"</span>,tacq, te, tr);
00107       exit(0);
00108    }
00109 }
00110 
<a name="l00119"></a><a class="code" href="group__Sequence.html#ga20">00119</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga20">SeqSpinEcho1D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00120 {
00121   <span class="keywordtype">int</span>      ntx;
00122   <span class="keywordtype">double</span>   fovx;
00123   <span class="keywordtype">double</span>   te,tr,tacq; <span class="comment">/* in ms */</span>
00124   <span class="keywordtype">double</span>   gx,gy,gz;
00125   <span class="keywordtype">double</span>   acq_delay,timp; <span class="comment">/* in ms */</span>
00126   <span class="keywordtype">int</span>    npy, npz;
00127   <span class="keywordtype">int</span> i;
00128   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00129   event = &amp;event_r;
00130 
00131    printf(<span class="stringliteral">"Starting SeqSpinEcho1D\n"</span>);  
00132    ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00133    tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00134    fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00135    
00136    te = seqparam-&gt;te;
00137    tr = seqparam-&gt;tr;
00138    
00139    <a class="code" href="group__Sequence.html#ga0">CheckTimesSE</a>(tacq,te,tr);
00140 
00141    acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00142    timp=0.3; <span class="comment">/*RF pulse duration in ms */</span>   
00143    gx=(ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;
00144    gy=0.0;
00145    gz=0.0;
00146    npy=0;npz=0;
00147 
00148    <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00149    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00150    <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00151 
00152    <span class="keywordflow">for</span>(i=0;i&lt;10;i++) <span class="comment">/* Repetition cycle to take TR into account */</span>
00153    {
00154     <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90., timp);
00155     <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, te/2.,gx,gy,gz);
00156     <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00157     <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, acq_delay+tacq,gx,gy,gz);
00158    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00159    }
00160    
00161    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00162    <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event, te/2.,gx,gy,gz);
00163    <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00164    <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00165 
00166    printf(<span class="stringliteral">"Ending SeqSpinEcho1D\n"</span>);  
00167 }
00168 
<a name="l00177"></a><a class="code" href="group__Sequence.html#ga21">00177</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga21">SeqSpinEcho2D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00178 {
00179   <span class="keywordtype">int</span>      ntx,nty;
00180   <span class="keywordtype">double</span>   fovx,fovy;
00181   <span class="keywordtype">double</span>   te,tr,tacq,timp,acq_delay,tg; <span class="comment">/* ms */</span>
00182   <span class="keywordtype">double</span>   gx,gy,gz,gp;
00183   <span class="keywordtype">int</span>    npy, npz;
00184   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00185   event = &amp;event_r;
00186 
00187    printf(<span class="stringliteral">"Starting SeqSpinEcho2D \n"</span>);  
00188    ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00189    nty = expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>;
00190    tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00191    fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00192    fovy = expr-&gt;<a class="code" href="struct__Experience3D.html#o12">fovy</a>;
00193 
00194    te = seqparam-&gt;te;
00195    tr = seqparam-&gt;tr;
00196    
00197    <a class="code" href="group__Sequence.html#ga0">CheckTimesSE</a>(tacq,te,tr);
00198    timp=0.3; <span class="comment">/*RF pulse duration in ms */</span>
00199    acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00200    tg = te/2.;
00201    gx = (ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;     
00202    gy = 2*M_PI*(nty-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovy/(tg/1000); 
00203    gz = 0.0;
00204    npz= 0;
00205 
00206    <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00207 
00208    <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00209    <span class="keywordflow">for</span> (npy = 0; npy &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>; npy++)
00210     {
00211       <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00212       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90.,timp);
00213 
00214       gp = (gy) * (npy - (nty) / 2) / (nty);
00215       <a class="code" href="group__Event.html#ga0">DoGradient</a>(expr,event,tg,gx,gp,gz);
00216 
00217       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00218 
00219       <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00220 
00221       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00222     }
00223    printf(<span class="stringliteral">"Ending SeqSpinEcho2D\n"</span>);  
00224 }
00225 
<a name="l00234"></a><a class="code" href="group__Sequence.html#ga22">00234</a> <span class="keywordtype">void</span> <a class="code" href="group__Sequence.html#ga22">SeqSpinEcho3D_0</a>(SEQPARAM *seqparam,<a class="code" href="struct__Experience3D.html">EXPERIENCE3D</a>*expr)
00235 {
00236   <span class="keywordtype">int</span>      ntx,nty,ntz;
00237   <span class="keywordtype">double</span>   fovx,fovy,fovz;
00238   <span class="keywordtype">double</span>   te,tr,tacq; <span class="comment">/* ms */</span>
00239   <span class="keywordtype">double</span>   gx,gy,gz,timp;
00240   <span class="keywordtype">double</span>   acq_delay;   <span class="comment">/* ms */</span>
00241   <span class="keywordtype">int</span>    npy,npz;
00242   <a class="code" href="struct__Event.html">EVENT</a>* event, event_r;
00243   event = &amp;event_r;
00244 
00245   printf(<span class="stringliteral">"Starting SeqSpinEcho3D\n"</span>);  
00246   ntx = expr-&gt;<a class="code" href="struct__Experience3D.html#o1">ntx</a>;
00247   nty = expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>;
00248   ntz = expr-&gt;<a class="code" href="struct__Experience3D.html#o3">ntz</a>;
00249   tacq = expr-&gt;<a class="code" href="struct__Experience3D.html#o4">readout_time</a>*1.e+3;
00250   fovx = expr-&gt;<a class="code" href="struct__Experience3D.html#o11">fovx</a>;
00251   fovy = expr-&gt;<a class="code" href="struct__Experience3D.html#o12">fovy</a>;
00252   fovz = expr-&gt;<a class="code" href="struct__Experience3D.html#o13">fovz</a>;
00253 
00254   te = seqparam-&gt;te;
00255   tr = seqparam-&gt;tr;
00256    
00257   <a class="code" href="group__Sequence.html#ga0">CheckTimesSE</a>(tacq,te,tr);
00258 
00259   acq_delay = (te/2) - (tacq/2. + tacq/2./(ntx-1));
00260    
00261   gx=(ntx-2.)/tacq/<a class="code" href="simri3d_8h.html#a3">G_kHz_G</a>/fovx;     
00262   gy=2*M_PI*(nty-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovy/(te/2./1000); 
00263   gz=2*M_PI*(ntz-1)/<a class="code" href="simri3d_8h.html#a4">G_rad_G</a>/fovz/(te/2./1000); 
00264   timp=0.3; <span class="comment">/* Pulse duration in ms */</span>
00265 
00266   <a class="code" href="group__Event.html#ga5">SetSpoilingFlag</a>(event,<a class="code" href="event_8h.html#a0">ACTIVE</a>); <span class="comment">/* XY Spoiling after each line acquisition */</span>
00267 
00268   <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,<a class="code" href="experience_8h.html#a0">ATT_INIT</a>); <span class="comment">/* To get an initial Magnetization M0 */</span>
00269   <span class="keywordflow">for</span> (npy = 0; npy &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o2">nty</a>; npy++) {
00270   <span class="keywordflow">for</span> (npz = 0; npz &lt; expr-&gt;<a class="code" href="struct__Experience3D.html#o3">ntz</a>; npz++) {
00271         <a class="code" href="group__Experience.html#ga9">ResetToExperience</a>(expr);
00272       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event, 90., timp);
00273       <a class="code" href="group__Event.html#ga0">DoGradient</a>( expr,event, te/2.,gx,
00274             (gy) * (npy - nty / 2) / nty,
00275                 (gz) * (npz - ntz / 2) / ntz);
00276       <a class="code" href="group__Event.html#ga0">DoPulseRect</a>(expr,event,180.,timp);
00277       <a class="code" href="group__Event.html#ga0">DoAcqFrequenceX</a>( expr,event, gx, npy, npz,acq_delay, <a class="code" href="simri3d_8h.html#a10">MINUS</a>);
00278       <a class="code" href="group__Event.html#ga1">DoWaiting</a>(expr,event,tr-te-tacq/2.0);
00279    }}
00280    printf(<span class="stringliteral">"Ending SeqSpinEcho3D\n"</span>);  
00281 }
00282 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:15 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
